"use strict";const U=require("../../../../../../../_virtual/sax.js");require("./conventions.js");const ee=require("../../../../../../../_virtual/conventions.js");var y=ee.__exports.NAMESPACE,d=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,q=new RegExp("[\\-\\.0-9"+d.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),z=new RegExp("^"+d.source+q.source+"*(?::"+d.source+q.source+"*)?$"),O=0,T=1,C=2,D=3,F=4,_=5,L=6,P=7;function k(e,r){this.message=e,this.locator=r,Error.captureStackTrace&&Error.captureStackTrace(this,k)}k.prototype=new Error;k.prototype.name=k.name;function K(){}K.prototype={parse:function(e,r,i){var a=this.domBuilder;a.startDocument(),S(r,r={}),re(e,r,i,a,this.errorHandler),a.endDocument()}};function re(e,r,i,a,t){function f(o){if(o>65535){o-=65536;var m=55296+(o>>10),B=56320+(o&1023);return String.fromCharCode(m,B)}else return String.fromCharCode(o)}function u(o){var m=o.slice(1,-1);return m in i?i[m]:m.charAt(0)==="#"?f(parseInt(m.substr(1).replace("x","0x"))):(t.error("entity not found:"+o),o)}function l(o){if(o>x){var m=e.substring(x,o).replace(/&#?\w+;/g,u);v&&n(x),a.characters(m,0,o-x),x=o}}function n(o,m){for(;o>=c&&(m=h.exec(e));)s=m.index,c=s+m[0].length,v.lineNumber++;v.columnNumber=o-s+1}for(var s=0,c=0,h=/.*(?:\r\n?|\n)|.*$/g,v=a.locator,E=[{currentNSMap:r}],$={},x=0;;){try{var p=e.indexOf("<",x);if(p<0){if(!e.substr(x).match(/^\s*$/)){var V=a.doc,X=V.createTextNode(e.substr(x));V.appendChild(X),a.currentElement=X}return}switch(p>x&&l(p),e.charAt(p+1)){case"/":var b=e.indexOf(">",p+3),g=e.substring(p+2,b).replace(/[ \t\n\r]+$/g,""),A=E.pop();b<0?(g=e.substring(p+2).replace(/[\s<].*/,""),t.error("end tag name: "+g+" is not complete:"+A.tagName),b=p+1+g.length):g.match(/\s</)&&(g=g.replace(/[\s<].*/,""),t.error("end tag name: "+g+" maybe not complete"),b=p+1+g.length);var N=A.localNSMap,j=A.tagName==g,Y=j||A.tagName&&A.tagName.toLowerCase()==g.toLowerCase();if(Y){if(a.endElement(A.uri,A.localName,g),N)for(var G in N)Object.prototype.hasOwnProperty.call(N,G)&&a.endPrefixMapping(G);j||t.fatalError("end tag name: "+g+" is not match the current start tagName:"+A.tagName)}else E.push(A);b++;break;case"?":v&&n(p),b=se(e,p,a);break;case"!":v&&n(p),b=ne(e,p,a,t);break;default:v&&n(p);var w=new W,I=E[E.length-1].currentNSMap,b=ie(e,p,w,I,u,t),M=w.length;if(!w.closed&&ae(e,b,w.tagName,$)&&(w.closed=!0,i.nbsp||t.warning("unclosed xml attribute")),v&&M){for(var H=Z(v,{}),R=0;R<M;R++){var Q=w[R];n(Q.offset),Q.locator=Z(v,{})}a.locator=H,J(w,a,I)&&E.push(w),a.locator=v}else J(w,a,I)&&E.push(w);y.isHTML(w.uri)&&!w.closed?b=te(e,b,w.tagName,u,a):b++}}catch(o){if(o instanceof k)throw o;t.error("element parse error: "+o),b=-1}b>x?x=b:l(Math.max(p,x)+1)}}function Z(e,r){return r.lineNumber=e.lineNumber,r.columnNumber=e.columnNumber,r}function ie(e,r,i,a,t,f){function u(v,E,$){i.attributeNames.hasOwnProperty(v)&&f.fatalError("Attribute "+v+" redefined"),i.addValue(v,E,$)}for(var l,n,s=++r,c=O;;){var h=e.charAt(s);switch(h){case"=":if(c===T)l=e.slice(r,s),c=D;else if(c===C)c=D;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(c===D||c===T)if(c===T&&(f.warning('attribute value must after "="'),l=e.slice(r,s)),r=s+1,s=e.indexOf(h,r),s>0)n=e.slice(r,s).replace(/&#?\w+;/g,t),u(l,n,r-1),c=_;else throw new Error("attribute value no end '"+h+"' match");else if(c==F)n=e.slice(r,s).replace(/&#?\w+;/g,t),u(l,n,r),f.warning('attribute "'+l+'" missed start quot('+h+")!!"),r=s+1,c=_;else throw new Error('attribute value must after "="');break;case"/":switch(c){case O:i.setTagName(e.slice(r,s));case _:case L:case P:c=P,i.closed=!0;case F:case T:break;case C:i.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return f.error("unexpected end of input"),c==O&&i.setTagName(e.slice(r,s)),s;case">":switch(c){case O:i.setTagName(e.slice(r,s));case _:case L:case P:break;case F:case T:n=e.slice(r,s),n.slice(-1)==="/"&&(i.closed=!0,n=n.slice(0,-1));case C:c===C&&(n=l),c==F?(f.warning('attribute "'+n+'" missed quot(")!'),u(l,n.replace(/&#?\w+;/g,t),r)):((!y.isHTML(a[""])||!n.match(/^(?:disabled|checked|selected)$/i))&&f.warning('attribute "'+n+'" missed value!! "'+n+'" instead!!'),u(n,n,r));break;case D:throw new Error("attribute value missed!!")}return s;case"Â€":h=" ";default:if(h<=" ")switch(c){case O:i.setTagName(e.slice(r,s)),c=L;break;case T:l=e.slice(r,s),c=C;break;case F:var n=e.slice(r,s).replace(/&#?\w+;/g,t);f.warning('attribute "'+n+'" missed quot(")!!'),u(l,n,r);case _:c=L;break}else switch(c){case C:i.tagName,(!y.isHTML(a[""])||!l.match(/^(?:disabled|checked|selected)$/i))&&f.warning('attribute "'+l+'" missed value!! "'+l+'" instead2!!'),u(l,l,r),r=s,c=T;break;case _:f.warning('attribute space is required"'+l+'"!!');case L:c=T,r=s;break;case D:c=F,r=s;break;case P:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function J(e,r,i){for(var a=e.tagName,t=null,h=e.length;h--;){var f=e[h],u=f.qName,l=f.value,v=u.indexOf(":");if(v>0)var n=f.prefix=u.slice(0,v),s=u.slice(v+1),c=n==="xmlns"&&s;else s=u,n=null,c=u==="xmlns"&&"";f.localName=s,c!==!1&&(t==null&&(t={},S(i,i={})),i[c]=t[c]=l,f.uri=y.XMLNS,r.startPrefixMapping(c,l))}for(var h=e.length;h--;){f=e[h];var n=f.prefix;n&&(n==="xml"&&(f.uri=y.XML),n!=="xmlns"&&(f.uri=i[n||""]))}var v=a.indexOf(":");v>0?(n=e.prefix=a.slice(0,v),s=e.localName=a.slice(v+1)):(n=null,s=e.localName=a);var E=e.uri=i[n||""];if(r.startElement(E,s,a,e),e.closed){if(r.endElement(E,s,a),t)for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.endPrefixMapping(n)}else return e.currentNSMap=i,e.localNSMap=t,!0}function te(e,r,i,a,t){if(/^(?:script|textarea)$/i.test(i)){var f=e.indexOf("</"+i+">",r),u=e.substring(r+1,f);if(/[&<]/.test(u))return/^script$/i.test(i)?(t.characters(u,0,u.length),f):(u=u.replace(/&#?\w+;/g,a),t.characters(u,0,u.length),f)}return r+1}function ae(e,r,i,a){var t=a[i];return t==null&&(t=e.lastIndexOf("</"+i+">"),t<r&&(t=e.lastIndexOf("</"+i)),a[i]=t),t<r}function S(e,r){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}function ne(e,r,i,a){var t=e.charAt(r+2);switch(t){case"-":if(e.charAt(r+3)==="-"){var f=e.indexOf("-->",r+4);return f>r?(i.comment(e,r+4,f-r-4),f+3):(a.error("Unclosed comment"),-1)}else return-1;default:if(e.substr(r+3,6)=="CDATA["){var f=e.indexOf("]]>",r+9);return i.startCDATA(),i.characters(e,r+9,f-r-9),i.endCDATA(),f+3}var u=ce(e,r),l=u.length;if(l>1&&/!doctype/i.test(u[0][0])){var n=u[1][0],s=!1,c=!1;l>3&&(/^public$/i.test(u[2][0])?(s=u[3][0],c=l>4&&u[4][0]):/^system$/i.test(u[2][0])&&(c=u[3][0]));var h=u[l-1];return i.startDTD(n,s,c),i.endDTD(),h.index+h[0].length}}return-1}function se(e,r,i){var a=e.indexOf("?>",r);if(a){var t=e.substring(r,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return t?(t[0].length,i.processingInstruction(t[1],t[2]),a+2):-1}return-1}function W(){this.attributeNames={}}W.prototype={setTagName:function(e){if(!z.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,r,i){if(!z.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:r,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}};function ce(e,r){var i,a=[],t=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(t.lastIndex=r,t.exec(e);i=t.exec(e);)if(a.push(i),i[1])return a}U.__exports.XMLReader=K;U.__exports.ParseError=k;module.exports=U.__exports;
//# sourceMappingURL=sax.js.map
