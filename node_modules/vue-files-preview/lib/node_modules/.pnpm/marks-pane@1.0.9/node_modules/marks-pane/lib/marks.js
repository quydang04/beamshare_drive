"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("../../../../../../_virtual/marks.js");require("./svg.js");require("./events.js");const _=require("../../../../../../_virtual/svg.js"),b=require("../../../../../../_virtual/events.js");exports.Pane=void 0;exports.Highlight=void 0;Object.defineProperty(s.__exports,"__esModule",{value:!0});exports.Underline=s.__exports.Underline=exports.Highlight=s.__exports.Highlight=s.__exports.Mark=exports.Pane=s.__exports.Pane=void 0;var k=function n(e,t,r){e===null&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(i===void 0){var o=Object.getPrototypeOf(e);return o===null?void 0:n(o,t,r)}else{if("value"in i)return i.value;var a=i.get;return a===void 0?void 0:a.call(r)}},g=function(){function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),w=_.__exports,c=v(w),x=b.__exports,C=v(x);function v(n){return n&&n.__esModule?n:{default:n}}function m(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n}function y(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}function p(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}exports.Pane=s.__exports.Pane=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document.body;p(this,n),this.target=e,this.element=c.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),C.default.proxyMouse(this.target,this.marks),this.container=t,this.container.appendChild(this.element),this.render()}return g(n,[{key:"addMark",value:function(t){var r=c.default.createElement("g");return this.element.appendChild(r),t.bind(r,this.container),this.marks.push(t),t.render(),t}},{key:"removeMark",value:function(t){var r=this.marks.indexOf(t);if(r!==-1){var i=t.unbind();this.element.removeChild(i),this.marks.splice(r,1)}}},{key:"render",value:function(){A(this.element,R(this.target,this.container));var t=!0,r=!1,i=void 0;try{for(var o=this.marks[Symbol.iterator](),a;!(t=(a=o.next()).done);t=!0){var h=a.value;h.render()}}catch(d){r=!0,i=d}finally{try{!t&&o.return&&o.return()}finally{if(r)throw i}}}}]),n}();var O=s.__exports.Mark=function(){function n(){p(this,n),this.element=null}return g(n,[{key:"bind",value:function(t,r){this.element=t,this.container=r}},{key:"unbind",value:function(){var t=this.element;return this.element=null,t}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(t){this.element&&this.element.dispatchEvent(t)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var t=[],r=this.element.firstChild;r;)t.push(r.getBoundingClientRect()),r=r.nextSibling;return t}},{key:"filteredRanges",value:function(){var t=Array.from(this.range.getClientRects());return t.filter(function(r){for(var i=0;i<t.length;i++){if(t[i]===r)return!0;var o=E(t[i],r);if(o)return!1}return!0})}}]),n}(),P=exports.Highlight=s.__exports.Highlight=function(n){y(e,n);function e(t,r,i,o){p(this,e);var a=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.range=t,a.className=r,a.data=i||{},a.attributes=o||{},a}return g(e,[{key:"bind",value:function(r,i){k(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"bind",this).call(this,r,i);for(var o in this.data)this.data.hasOwnProperty(o)&&(this.element.dataset[o]=this.data[o]);for(var o in this.attributes)this.attributes.hasOwnProperty(o)&&this.element.setAttribute(o,this.attributes[o]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var r=this.element.ownerDocument.createDocumentFragment(),i=this.filteredRanges(),o=this.element.getBoundingClientRect(),a=this.container.getBoundingClientRect(),h=0,d=i.length;h<d;h++){var l=i[h],u=c.default.createElement("rect");u.setAttribute("x",l.left-o.left+a.left),u.setAttribute("y",l.top-o.top+a.top),u.setAttribute("height",l.height),u.setAttribute("width",l.width),r.appendChild(u)}this.element.appendChild(r)}}]),e}(O);exports.Underline=s.__exports.Underline=function(n){y(e,n);function e(t,r,i,o){return p(this,e),m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,i,o))}return g(e,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var r=this.element.ownerDocument.createDocumentFragment(),i=this.filteredRanges(),o=this.element.getBoundingClientRect(),a=this.container.getBoundingClientRect(),h=0,d=i.length;h<d;h++){var l=i[h],u=c.default.createElement("rect");u.setAttribute("x",l.left-o.left+a.left),u.setAttribute("y",l.top-o.top+a.top),u.setAttribute("height",l.height),u.setAttribute("width",l.width),u.setAttribute("fill","none");var f=c.default.createElement("line");f.setAttribute("x1",l.left-o.left+a.left),f.setAttribute("x2",l.left-o.left+a.left+l.width),f.setAttribute("y1",l.top-o.top+a.top+l.height-1),f.setAttribute("y2",l.top-o.top+a.top+l.height-1),f.setAttribute("stroke-width",1),f.setAttribute("stroke","black"),f.setAttribute("stroke-linecap","square"),r.appendChild(u),r.appendChild(f)}this.element.appendChild(r)}}]),e}(P);function R(n,e){var t=e.getBoundingClientRect(),r=n.getBoundingClientRect();return{top:r.top-t.top,left:r.left-t.left,height:n.scrollHeight,width:n.scrollWidth}}function A(n,e){n.style.setProperty("top",e.top+"px","important"),n.style.setProperty("left",e.left+"px","important"),n.style.setProperty("height",e.height+"px","important"),n.style.setProperty("width",e.width+"px","important")}function E(n,e){return e.right<=n.right&&e.left>=n.left&&e.top>=n.top&&e.bottom<=n.bottom}exports.default=s.__exports;
//# sourceMappingURL=marks.js.map
