{"version":3,"file":"index.js","sources":["../../../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/managers/default/index.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber} from \"../../utils/core\";\nimport scrollType from \"../../utils/scrolltype\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.optsSettings = options.settings;\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\taxis: undefined,\n\t\t\twritingMode: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\tignoreClass: \"\",\n\t\t\tfullsize: undefined,\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: true,\n\t\t\tallowScriptedContent: this.settings.allowScriptedContent,\n\t\t\tallowPopups: this.settings.allowPopups\n\t\t};\n\n\t\tthis.rendered = false;\n\n\t}\n\n\trender(element, size){\n\t\tlet tag = element.tagName;\n\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\n\t\t\t\ttag && (tag.toLowerCase() == \"body\" ||\n\t\t\t\ttag.toLowerCase() == \"html\")) {\n\t\t\t\tthis.settings.fullsize = true;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tthis.settings.overflow = \"visible\";\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.settings.size = size;\n\n\t\tthis.settings.rtlScrollType = scrollType();\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis,\n\t\t\tfullsize: this.settings.fullsize,\n\t\t\tdirection: this.settings.direction\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\n\t\tthis.rendered = true;\n\n\t}\n\n\taddEventListeners(){\n\t\tvar scroller;\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tdestroy(){\n\t\tclearTimeout(this.orientationTimeout);\n\t\tclearTimeout(this.resizeTimeout);\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.clear();\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.stage.destroy();\n\n\t\tthis.rendered = false;\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t}\n\n\tonOrientationChange(e) {\n\t\tlet {orientation} = window;\n\n\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\tthis.resize();\n\t\t}\n\n\t\t// Per ampproject:\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\n\t\t// element size depends on window size directly and the measurement\n\t\t// happens in window.resize event. Adding a timeout for correct\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\n\t\tclearTimeout(this.orientationTimeout);\n\t\tthis.orientationTimeout = setTimeout(function(){\n\t\t\tthis.orientationTimeout = undefined;\n\n\t\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\t\tthis.resize();\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n\t\t}.bind(this), 500);\n\n\t}\n\n\tonResized(e) {\n\t\tthis.resize();\n\t}\n\n\tresize(width, height, epubcfi){\n\t\tlet stageSize = this.stage.size(width, height);\n\n\t\t// For Safari, wait for orientation to catch up\n\t\t// if the window is a square\n\t\tthis.winBounds = windowBounds();\n\t\tif (this.orientationTimeout &&\n\t\t\t\tthis.winBounds.width === this.winBounds.height) {\n\t\t\t// reset the stage size for next resize\n\t\t\tthis._stageSize = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._stageSize &&\n\t\t\t\tthis._stageSize.width === stageSize.width &&\n\t\t\t\tthis._stageSize.height === stageSize.height ) {\n\t\t\t// Size is the same, no need to resize\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = stageSize;\n\n\t\tthis._bounds = this.bounds();\n\n\t\t// Clear current views\n\t\tthis.clear();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\n\t\t\twidth: this._stageSize.width,\n\t\t\theight: this._stageSize.height\n\t\t}, epubcfi);\n\t}\n\n\tcreateView(section, forceRight) {\n\t\treturn new this.View(section, extend(this.viewSettings, { forceRight }) );\n\t}\n\n\thandleNextPrePaginated(forceRight, section, action) {\n\t\tlet next;\n\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\tif (forceRight || section.index === 0) {\n\t\t\t\t// First page (cover) should stand alone for pre-paginated books\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnext = section.next();\n\t\t\tif (next && !next.properties.includes(\"page-spread-left\")) {\n\t\t\t\treturn action.call(this, next);\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check if moving to target is needed\n\t\tif (target === section.href || isNumber(target)) {\n\t\t\ttarget = undefined;\n\t\t}\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location in view\n\t\tif(visible && section && this.layout.name !== \"pre-paginated\") {\n\t\t\tlet offset = visible.offset();\n\n\t\t\tif (this.settings.direction === \"ltr\") {\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\n\t\t\t} else {\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\n\t\t\t}\n\n\t\t\tif(target) {\n\t\t\t\tlet offset = visible.locationOf(target);\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.moveTo(offset, width);\n\t\t\t}\n\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.clear();\n\n\t\tlet forceRight = false;\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\n\t\t\tforceRight = true;\n\t\t}\n\n\t\tthis.add(section, forceRight)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\tlet offset = view.locationOf(target);\n\t\t\t\t\tlet width = view.width();\n\t\t\t\t\tthis.moveTo(offset, width);\n\t\t\t\t}\n\n\t\t\t}.bind(this), (err) => {\n\t\t\t\tdisplaying.reject(err);\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\treturn this.handleNextPrePaginated(forceRight, section, this.add);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this));\n\t\t// .then(function(){\n\t\t// \treturn this.hooks.display.trigger(view);\n\t\t// }.bind(this))\n\t\t// .then(function(){\n\t\t// \tthis.views.show();\n\t\t// }.bind(this));\n\t\treturn displayed;\n\t}\n\n\tafterDisplayed(view){\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\tmoveTo(offset, width){\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\n\t\t\tdistY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distY + this.layout.delta > this.container.scrollHeight) {\n\t\t\t\tdistY = this.container.scrollHeight - this.layout.delta;\n\t\t\t}\n\t\t}\n\t\tif(this.settings.direction === 'rtl'){\n\t\t\t/***\n\t\t\t\tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta`\n\t\t\t\tto distX or use `Math.ceil` function, or multiply offset.left by -1\n\t\t\t\tbefore `Math.floor`\n\t\t\t*/\n\t\t\tdistX = distX + this.layout.delta\n\t\t\tdistX = distX - width\n\t\t}\n\t\tthis.scrollTo(distX, distY, true);\n\t}\n\n\tadd(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tappend(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tprepend(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar left;\n\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\tleft = this.container.scrollLeft;\n\n\t\t\t\tif (left > 0) {\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tnext = this.views.last().section.next();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tleft = this.container.scrollLeft + ( this.layout.delta * -1 );\n\n\t\t\t\tif (left > this.container.scrollWidth * -1){\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tnext = this.views.last().section.next();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top  = this.container.scrollTop + this.container.offsetHeight;\n\n\t\t\tif(top < this.container.scrollHeight) {\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else {\n\t\t\tnext = this.views.last().section.next();\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.clear();\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\t\t\tthis.updateLayout();\n\n\t\t\tlet forceRight = false;\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\n\t\t\t\tforceRight = true;\n\t\t\t}\n\n\t\t\treturn this.append(next, forceRight)\n\t\t\t\t.then(function(){\n\t\t\t\t\treturn this.handleNextPrePaginated(forceRight, next, this.append);\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\n\t\t\t\t\t// Reset position to start for scrolled-doc vertical-rl in default mode\n\t\t\t\t\tif (!this.isPaginated &&\n\t\t\t\t\t\tthis.settings.axis === \"horizontal\" &&\n\t\t\t\t\t\tthis.settings.direction === \"rtl\" &&\n\t\t\t\t\t\tthis.settings.rtlScrollType === \"default\") {\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth, 0, true);\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t}\n\n\tprev(){\n\t\tvar prev;\n\t\tvar left;\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth;\n\n\t\t\t\tif (left < this.container.scrollWidth) {\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tleft = this.container.scrollLeft;\n\n\t\t\t\tif (left < 0) {\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top = this.container.scrollTop;\n\n\t\t\tif(top > 0) {\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.clear();\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\t\t\tthis.updateLayout();\n\n\t\t\tlet forceRight = false;\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\n\t\t\t\tforceRight = true;\n\t\t\t}\n\n\t\t\treturn this.prepend(prev, forceRight)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\t\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tthis.scrollTo((this.container.scrollWidth * -1) + this.layout.delta, 0, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear () {\n\n\t\t// this.q.clear();\n\n\t\tif (this.views) {\n\t\t\tthis.views.hide();\n\t\t\tthis.scrollTo(0,0, true);\n\t\t\tthis.views.clear();\n\t\t}\n\t}\n\n\tcurrentLocation(){\n\t\tthis.updateLayout();\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t} else {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t}\n\t\treturn this.location;\n\t}\n\n\tscrolledLocation() {\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\t\tlet pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\t\tlet pageWidth = (container.width < window.innerWidth) ? container.width : window.innerWidth;\n\t\tlet vertical = (this.settings.axis === \"vertical\");\n\t\tlet rtl =  (this.settings.direction === \"rtl\");\n\t\t\n\t\tlet offset = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\toffset = vertical ? window.scrollY : window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet position = view.position();\n\t\t\tlet width = view.width();\n\t\t\tlet height = view.height();\n\n\t\t\tlet startPos;\n\t\t\tlet endPos;\n\t\t\tlet stopPos;\n\t\t\tlet totalPages;\n\n\t\t\tif (vertical) {\n\t\t\t\tstartPos = offset + container.top - position.top + used;\n\t\t\t\tendPos = startPos + pageHeight - used;\n\t\t\t\ttotalPages = this.layout.count(height, pageHeight).pages;\n\t\t\t\tstopPos = pageHeight;\n\t\t\t} else {\n\t\t\t\tstartPos = offset + container.left - position.left + used;\n\t\t\t\tendPos = startPos + pageWidth - used;\n\t\t\t\ttotalPages = this.layout.count(width, pageWidth).pages;\n\t\t\t\tstopPos = pageWidth;\n\t\t\t}\n\n\t\t\tlet currPage = Math.ceil(startPos / stopPos);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.ceil(endPos / stopPos);\n\n\t\t\t// Reverse page counts for horizontal rtl\n\t\t\tif (this.settings.direction === \"rtl\" && !vertical) {\n\t\t\t\tlet tempStartPage = currPage;\n\t\t\t\tcurrPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\t\t\tpages = [];\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\n\t\t\t\tlet pg = i + 1;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tpaginatedLocation(){\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\n\t\tlet left = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\tleft = window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet offset;\n\t\t\tlet position = view.position();\n\t\t\tlet width = view.width();\n\n\t\t\t// Find mapping\n\t\t\tlet start;\n\t\t\tlet end;\n\t\t\tlet pageWidth;\n\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\toffset = container.right - left;\n\t\t\t\tpageWidth = Math.min(Math.abs(offset - position.left), this.layout.width) - used;\n\t\t\t\tend = position.width - (position.right - offset) - used;\n\t\t\t\tstart = end - pageWidth;\n\t\t\t} else {\n\t\t\t\toffset = container.left + left;\n\t\t\t\tpageWidth = Math.min(position.right - offset, this.layout.width) - used;\n\t\t\t\tstart = offset - position.left + used;\n\t\t\t\tend = start + pageWidth;\n\t\t\t}\n\n\t\t\tused += pageWidth;\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n\n\t\t\tlet totalPages = this.layout.count(width).pages;\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\n\t\t\t\n\t\t\t// start page should not be negative\n\t\t\tif (startPage < 0) {\n\t\t\t\tstartPage = 0;\n\t\t\t\tendPage = endPage + 1;\n\t\t\t}\n\n\t\t\t// Reverse page counts for rtl\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\tlet tempStartPage = startPage;\n\t\t\t\tstartPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\n\t\t\t\tlet pg = i;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvisible(){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t}\n\n\tscrollBy(x, y, silent){\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tif(x) this.container.scrollLeft += x * dir;\n\t\t\tif(y) this.container.scrollTop += y;\n\t\t} else {\n\t\t\twindow.scrollBy(x * dir, y * dir);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY;\n\t\t\tscrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\t\ttop: scrollTop,\n\t\t\t\tleft: scrollLeft\n\t\t\t});\n\n\t\t\tclearTimeout(this.afterScrolled);\n\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t});\n\t\t\t}.bind(this), 20);\n\n\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t}\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t}\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\t\tif (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\n\t\t\tthis.display(this.views.first().section);\n\t\t}\n\t\t // this.manager.layout(this.layout.format);\n\t}\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(!this.isPaginated) {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta / this.layout.divisor;\n\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\t}\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.forEach(function(view){\n\t\t\t\tif (view) {\n\t\t\t\t\tview.setLayout(layout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tupdateWritingMode(mode) {\n\t\tthis.writingMode = mode;\n\t}\n\n\tupdateAxis(axis, forceUpdate){\n\n\t\tif (!forceUpdate && axis === this.settings.axis) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.stage && this.stage.axis(axis);\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tif (this.mapping) {\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n\t\t}\n\n\t\tif (this.layout) {\n\t\t\tif (axis === \"vertical\") {\n\t\t\t\tthis.layout.spread(\"none\");\n\t\t\t} else {\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFlow(flow, defaultScrolledOverflow=\"auto\"){\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\n\n\t\tthis.isPaginated = isPaginated;\n\n\t\tif (flow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\tflow === \"scrolled\") {\n\t\t\tthis.updateAxis(\"vertical\");\n\t\t} else {\n\t\t\tthis.updateAxis(\"horizontal\");\n\t\t}\n\n\t\tthis.viewSettings.flow = flow;\n\n\t\tif (!this.settings.overflow) {\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\n\t\t} else {\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.stage && this.stage.overflow(this.overflow);\n\n\t\tthis.updateLayout();\n\n\t}\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tif (!this.views) {\n\t\t\treturn contents;\n\t\t}\n\t\tthis.views.forEach(function(view){\n\t\t\tconst viewContents = view && view.contents;\n\t\t\tif (viewContents) {\n\t\t\t\tcontents.push(viewContents);\n\t\t\t}\n\t\t});\n\t\treturn contents;\n\t}\n\n\tdirection(dir=\"ltr\") {\n\t\tthis.settings.direction = dir;\n\n\t\tthis.stage && this.stage.direction(dir);\n\n\t\tthis.viewSettings.direction = dir;\n\n\t\tthis.updateLayout();\n\t}\n\n\tisRendered() {\n\t\treturn this.rendered;\n\t}\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n"],"names":["DefaultViewManager","options","Queue","extend","element","size","tag","scrollType","Stage","Views","scroller","e","orientation","EVENTS","width","height","epubcfi","stageSize","windowBounds","section","forceRight","action","next","target","displaying","defer","displayed","isNumber","visible","offset","view","err","distX","distY","axis","mode","bounds","left","dir","prev","container","pageHeight","pageWidth","vertical","used","index","href","position","startPos","endPos","stopPos","totalPages","currPage","pages","endPage","tempStartPage","i","pg","mapping","start","end","startPage","offsetPrev","offsetNext","_container","views","viewsLength","isVisible","x","y","silent","scrollTop","scrollLeft","layout","Mapping","forceUpdate","flow","defaultScrolledOverflow","isPaginated","contents","viewContents","EventEmitter"],"mappings":"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","x_google_ignoreList":[0]}