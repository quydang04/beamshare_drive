{"version":3,"file":"rendition.js","sources":["../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/rendition.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n * @param {string} [options.defaultDirection='ltr'] default text direction\n * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content\n * @param {boolean} [options.allowPopups=false] enable opening popup in content\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: \"\",\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800,\n\t\t\tstylesheet: null,\n\t\t\tresizeOnOrientationChange: true,\n\t\t\tscript: null,\n\t\t\tsnap: false,\n\t\t\tdefaultDirection: \"ltr\",\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.book = book;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @member {object} hooks\n\t\t * @property {Hook} hooks.content\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.unloaded = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\n\n\t\tthis.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n\n\t\tif (this.settings.stylesheet) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n\t\t}\n\n\t\tif (this.settings.script) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectScript.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * @member {Themes} themes\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.themes = new Themes(this);\n\n\t\t/**\n\t\t * @member {Annotations} annotations\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.annotations = new Annotations(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\t/**\n\t\t * A Rendered Location Range\n\t\t * @typedef location\n\t\t * @type {Object}\n\t\t * @property {object} start\n\t\t * @property {string} start.index\n\t\t * @property {string} start.href\n\t\t * @property {object} start.displayed\n\t\t * @property {EpubCFI} start.cfi\n\t\t * @property {number} start.location\n\t\t * @property {number} start.percentage\n\t\t * @property {number} start.displayed.page\n\t\t * @property {number} start.displayed.total\n\t\t * @property {object} end\n\t\t * @property {string} end.index\n\t\t * @property {string} end.href\n\t\t * @property {object} end.displayed\n\t\t * @property {EpubCFI} end.cfi\n\t\t * @property {number} end.location\n\t\t * @property {number} end.percentage\n\t\t * @property {number} end.displayed.page\n\t\t * @property {number} end.displayed.total\n\t\t * @property {boolean} atStart\n\t\t * @property {boolean} atEnd\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.location = undefined;\n\n\t\t// Hold queue until book is opened\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\tthis.starting = new defer();\n\t\t/**\n\t\t * @member {promise} started returns after the rendition has started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.started = this.starting.promise;\n\n\t\t// Block the queue until rendering is started\n\t\tthis.q.enqueue(this.start);\n\t}\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t}\n\n\t/**\n\t * Require the manager from passed string, or as a class function\n\t * @param  {string|object} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from imported managers\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\n\t\t\tviewManager = DefaultViewManager;\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\n\t\t\tviewManager = ContinuousViewManager;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tviewManager = manager;\n\t\t}\n\n\t\treturn viewManager;\n\t}\n\n\t/**\n\t * Require the view from passed string, or as a class function\n\t * @param  {string|object} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\t// If view is a string, try to load from imported views,\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\n\t\t\tView = IframeView;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tView = view;\n\t\t}\n\n\t\treturn View;\n\t}\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\t\tif (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\n\t\t\tthis.settings.layout = \"pre-paginated\";\n\t\t}\n\t\tswitch(this.book.package.metadata.spread) {\n\t\t\tcase 'none':\n\t\t\t\tthis.settings.spread = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 'both':\n\t\t\t\tthis.settings.spread = true;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\tthis.direction(this.book.package.metadata.direction || this.settings.defaultDirection);\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n\t\t// Listen for rotation\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n\t\t/**\n\t\t * Emit that rendering has started\n\t\t * @event started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t}\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Emit that rendering has attached to an element\n\t\t\t * @event attached\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\n\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\t\tif (this.displaying) {\n\t\t\tthis.displaying.resolve();\n\t\t}\n\t\treturn this.q.enqueue(this._display, target);\n\t}\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tif (!this.book) {\n\t\t\treturn;\n\t\t}\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\tthis.displaying = displaying;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length() && isFloat(target)) {\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\tthis.manager.display(section, target)\n\t\t\t.then(() => {\n\t\t\t\tdisplaying.resolve(section);\n\t\t\t\tthis.displaying = undefined;\n\n\t\t\t\t/**\n\t\t\t\t * Emit that a section has been displayed\n\t\t\t\t * @event displayed\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\n\t\t\t\tthis.reportLocation();\n\t\t\t}, (err) => {\n\t\t\t\t/**\n\t\t\t\t * Emit that has been an error displaying\n\t\t\t\t * @event displayError\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n\t\t\t});\n\n\t\treturn displayed;\n\t}\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t}\n\t*/\n\n\t/**\n\t * Report what section has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view.contents));\n\n\t\tthis.hooks.render.trigger(view, this)\n\t\t\t.then(() => {\n\t\t\t\tif (view.contents) {\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Emit that a section has been rendered\n\t\t\t\t\t\t * @event rendered\n\t\t\t\t\t\t * @param {Section} section\n\t\t\t\t\t\t * @param {View} view\n\t\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t\t */\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Report what has been removed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterRemoved(view){\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\n\t\t\t/**\n\t\t\t * Emit that a section has been removed\n\t\t\t * @event removed\n\t\t\t * @param {Section} section\n\t\t\t * @param {View} view\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n\t\t});\n\t}\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size, epubcfi){\n\n\t\t/**\n\t\t * Emit that the rendition has been resized\n\t\t * @event resized\n\t\t * @param {number} width\n\t\t * @param {height} height\n\t\t * @param {string} epubcfi (optional)\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t}, epubcfi);\n\n\t\tif (this.location && this.location.start) {\n\t\t\tthis.display(epubcfi || this.location.start.cfi);\n\t\t}\n\n\t}\n\n\t/**\n\t * Report orientation events and display the last seen location\n\t * @private\n\t */\n\tonOrientationChange(orientation){\n\t\t/**\n\t\t * Emit that the rendition has been rotated\n\t\t * @event orientationchange\n\t\t * @param {string} orientation\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n\t}\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t}\n\n\t/**\n\t * Trigger a resize of the views\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t * @param {string} [epubcfi] (optional)\n\t */\n\tresize(width, height, epubcfi){\n\t\tif (width) {\n\t\t\tthis.settings.width = width;\n\t\t}\n\t\tif (height) {\n\t\t\tthis.settings.height = height;\n\t\t}\n\t\tthis.manager.resize(width, height, epubcfi);\n\t}\n\n\t/**\n\t * Clear all rendered views\n\t */\n\tclear(){\n\t\tthis.manager.clear();\n\t}\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\n\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\n\t\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth,\n\t\t\tdirection: direction\n\t\t};\n\n\t\treturn properties;\n\t}\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled\" ||\n\t\t\t\tflow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tthis.settings.flow = flow;\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\t// this.mapping = new Mapping(this._layout.props);\n\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n\t\t\t})\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t}\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} [min] min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis.settings.spread = spread;\n\n\t\tif (min) {\n\t\t\tthis.settings.minSpreadWidth = min;\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.spread(spread, min);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the direction of the rendition\n\t * @param  {string} dir\n\t */\n\tdirection(dir){\n\n\t\tthis.settings.direction = dir || \"ltr\";\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.direction(this.settings.direction);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Report the current location\n\t * @fires relocated\n\t * @fires locationChanged\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function reportedLocation(){\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\n\t\t\t\tvar location = this.manager.currentLocation();\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\t\tlet located = this.located(result);\n\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else if (location) {\n\t\t\t\t\tlet located = this.located(location);\n\n\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event locationChanged\n\t\t\t\t\t * @deprecated\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t * @property {number} index\n\t\t\t\t\t * @property {string} href\n\t\t\t\t\t * @property {EpubCFI} start\n\t\t\t\t\t * @property {EpubCFI} end\n\t\t\t\t\t * @property {number} percentage\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t});\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event relocated\n\t\t\t\t\t * @type {displayedLocation}\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get the Current Location object\n\t * @return {displayedLocation | promise} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tlet located = this.located(result);\n\t\t\t\treturn located;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tlet located = this.located(location);\n\t\t\treturn located;\n\t\t}\n\t}\n\n\t/**\n\t * Creates a Rendition#locationRange from location\n\t * passed by the Manager\n\t * @returns {displayedLocation}\n\t * @private\n\t */\n\tlocated(location){\n\t\tif (!location.length) {\n\t\t\treturn {};\n\t\t}\n\t\tlet start = location[0];\n\t\tlet end = location[location.length-1];\n\n\t\tlet located = {\n\t\t\tstart: {\n\t\t\t\tindex: start.index,\n\t\t\t\thref: start.href,\n\t\t\t\tcfi: start.mapping.start,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: start.pages[0] || 1,\n\t\t\t\t\ttotal: start.totalPages\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tindex: end.index,\n\t\t\t\thref: end.href,\n\t\t\t\tcfi: end.mapping.end,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: end.pages[end.pages.length-1] || 1,\n\t\t\t\t\ttotal: end.totalPages\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n\t\tif (locationStart != null) {\n\t\t\tlocated.start.location = locationStart;\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n\t\t}\n\t\tif (locationEnd != null) {\n\t\t\tlocated.end.location = locationEnd;\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n\t\t}\n\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n\t\tif (pageStart != -1) {\n\t\t\tlocated.start.page = pageStart;\n\t\t}\n\t\tif (pageEnd != -1) {\n\t\t\tlocated.end.page = pageEnd;\n\t\t}\n\n\t\tif (end.index === this.book.spine.last().index &&\n\t\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\n\t\t\tlocated.atEnd = true;\n\t\t}\n\n\t\tif (start.index === this.book.spine.first().index &&\n\t\t\t\tlocated.start.displayed.page === 1) {\n\t\t\tlocated.atStart = true;\n\t\t}\n\n\t\treturn located;\n\t}\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\t// this.q.clear();\n\t\t// this.q = undefined;\n\n\t\tthis.manager && this.manager.destroy();\n\n\t\tthis.book = undefined;\n\n\t\t// this.views = null;\n\n\t\t// this.hooks.display.clear();\n\t\t// this.hooks.serialize.clear();\n\t\t// this.hooks.content.clear();\n\t\t// this.hooks.layout.clear();\n\t\t// this.hooks.render.clear();\n\t\t// this.hooks.show.clear();\n\t\t// this.hooks = {};\n\n\t\t// this.themes.destroy();\n\t\t// this.themes = undefined;\n\n\t\t// this.epubcfi = undefined;\n\n\t\t// this.starting = undefined;\n\t\t// this.started = undefined;\n\n\n\t}\n\n\t/**\n\t * Pass the events from a view's Contents\n\t * @private\n\t * @param  {Contents} view contents\n\t */\n\tpassEvents(contents){\n\t\tDOM_EVENTS.forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\n\t}\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {string} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange, contents){\n\t\t/**\n\t\t * Emit that a text selection has occurred\n\t\t * @event selected\n\t\t * @param {string} cfirange\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n\t}\n\n\t/**\n\t * Emit a markClicked event with the cfiRange and data from a mark\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerMarkEvent(cfiRange, data, contents){\n\t\t/**\n\t\t * Emit that a mark was clicked\n\t\t * @event markClicked\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {object} data\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n\t}\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\tgetRange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.manager.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\n\t\t}\n\t}\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\tadjustImages(contents) {\n\n\t\tif (this._layout.name === \"pre-paginated\") {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n\t\tlet horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\n\n\t\tcontents.addStylesheetRules({\n\t\t\t\"img\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"object-fit\": \"contain\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\",\n\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t},\n\t\t\t\"svg\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\"\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Get the Contents object of each rendered view\n\t * @returns {Contents[]}\n\t */\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t}\n\n\t/**\n\t * Get the views member from the manager\n\t * @returns {Views}\n\t */\n\tviews () {\n\t\tlet views = this.manager ? this.manager.views : undefined;\n\t\treturn views || [];\n\t}\n\n\t/**\n\t * Hook to handle link clicks in rendered content\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\thandleLinks(contents) {\n\t\tif (contents) {\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\n\t\t\t\tlet relative = this.book.path.relative(href);\n\t\t\t\tthis.display(relative);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook to handle injecting stylesheet before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectStylesheet(doc, section) {\n\t\tlet style = doc.createElement(\"link\");\n\t\tstyle.setAttribute(\"type\", \"text/css\");\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\n\t}\n\n\t/**\n\t * Hook to handle injecting scripts before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectScript(doc, section) {\n\t\tlet script = doc.createElement(\"script\");\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", this.settings.script);\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n\t/**\n\t * Hook to handle the document identifier before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectIdentifier(doc, section) {\n\t\tlet ident = this.book.packaging.metadata.identifier;\n\t\tlet meta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\t\tif (ident) {\n\t\t\tmeta.setAttribute(\"content\", ident);\n\t\t}\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\n\t}\n\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n"],"names":["Rendition","book","options","extend","Hook","Themes","Annotations","EpubCFI","Queue","defer","manager","viewManager","DefaultViewManager","ContinuousViewManager","view","View","IframeView","EVENTS","element","target","displaying","displayed","section","isFloat","err","cfiRange","data","size","epubcfi","orientation","offset","width","height","metadata","properties","layout","spread","flow","viewport","minSpreadWidth","direction","_flow","settings","Layout","props","changed","min","dir","location","result","located","start","end","locationStart","locationEnd","pageStart","pageEnd","contents","DOM_EVENTS","ev","e","cfirange","cfi","ignoreClass","_cfi","found","resolve","computed","horizontalPadding","reject","href","relative","doc","style","script","ident","meta","EventEmitter"],"mappings":"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","x_google_ignoreList":[0]}