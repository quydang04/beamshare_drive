{"version":3,"file":"pagelist.js","sources":["../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/pagelist.js"],"sourcesContent":["import EpubCFI from \"./epubcfi\";\nimport {\n\tqs,\n\tqsa,\n\tquerySelectorByType,\n\tindexOfSorted,\n\tlocationOf\n} from \"./utils/core\";\n\n/**\n * Page List Parser\n * @param {document} [xml]\n */\nclass PageList {\n\tconstructor(xml) {\n\t\tthis.pages = [];\n\t\tthis.locations = [];\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.firstPage = 0;\n\t\tthis.lastPage = 0;\n\t\tthis.totalPages = 0;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\n\t\tif (xml) {\n\t\t\tthis.pageList = this.parse(xml);\n\t\t}\n\n\t\tif(this.pageList && this.pageList.length) {\n\t\t\tthis.process(this.pageList);\n\t\t}\n\t}\n\n\t/**\n\t * Parse PageList Xml\n\t * @param  {document} xml\n\t */\n\tparse(xml) {\n\t\tvar html = qs(xml, \"html\");\n\t\tvar ncx = qs(xml, \"ncx\");\n\n\t\tif(html) {\n\t\t\treturn this.parseNav(xml);\n\t\t} else if(ncx){\n\t\t\treturn this.parseNcx(xml);\n\t\t}\n\n\t}\n\n\t/**\n\t * Parse a Nav PageList\n\t * @private\n\t * @param  {node} navHtml\n\t * @return {PageList.item[]} list\n\t */\n\tparseNav(navHtml){\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"page-list\");\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\n\t\tvar length = navItems.length;\n\t\tvar i;\n\t\tvar list = [];\n\t\tvar item;\n\n\t\tif(!navItems || length === 0) return list;\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.item(navItems[i]);\n\t\t\tlist.push(item);\n\t\t}\n\n\t\treturn list;\n\t}\n\n\tparseNcx(navXml) {\n\t\tvar list = [];\n\t\tvar i = 0;\n\t\tvar item;\n\t\tvar pageList;\n\t\tvar pageTargets;\n\t\tvar length = 0;\n\n\t\tpageList = qs(navXml, \"pageList\");\n\t\tif (!pageList) return list;\n\n\t\tpageTargets = qsa(pageList, \"pageTarget\");\n\t\tlength = pageTargets.length;\n\n\t\tif (!pageTargets || pageTargets.length === 0) {\n\t\t\treturn list;\n\t\t}\n\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\titem = this.ncxItem(pageTargets[i]);\n\t\t\tlist.push(item);\n\t\t}\n\n\t\treturn list;\n\t}\n\n\tncxItem(item) {\n\t\tvar navLabel = qs(item, \"navLabel\");\n\t\tvar navLabelText = qs(navLabel, \"text\");\n\t\tvar pageText = navLabelText.textContent;\n\t\tvar content = qs(item, \"content\");\n\n\t\tvar href = content.getAttribute(\"src\");\n\t\tvar page = parseInt(pageText, 10);\n\n\t\treturn {\n\t\t\t\"href\": href,\n\t\t\t\"page\": page,\n\t\t};\n\t}\n\n\t/**\n\t * Page List Item\n\t * @private\n\t * @param  {node} item\n\t * @return {object} pageListItem\n\t */\n\titem(item){\n\t\tvar content = qs(item, \"a\"),\n\t\t\t\thref = content.getAttribute(\"href\") || \"\",\n\t\t\t\ttext = content.textContent || \"\",\n\t\t\t\tpage = parseInt(text),\n\t\t\t\tisCfi = href.indexOf(\"epubcfi\"),\n\t\t\t\tsplit,\n\t\t\t\tpackageUrl,\n\t\t\t\tcfi;\n\n\t\tif(isCfi != -1) {\n\t\t\tsplit = href.split(\"#\");\n\t\t\tpackageUrl = split[0];\n\t\t\tcfi = split.length > 1 ? split[1] : false;\n\t\t\treturn {\n\t\t\t\t\"cfi\" : cfi,\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"packageUrl\" : packageUrl,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t\"href\" : href,\n\t\t\t\t\"page\" : page\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Process pageList items\n\t * @private\n\t * @param  {array} pageList\n\t */\n\tprocess(pageList){\n\t\tpageList.forEach(function(item){\n\t\t\tthis.pages.push(item.page);\n\t\t\tif (item.cfi) {\n\t\t\t\tthis.locations.push(item.cfi);\n\t\t\t}\n\t\t}, this);\n\t\tthis.firstPage = parseInt(this.pages[0]);\n\t\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\n\t\tthis.totalPages = this.lastPage - this.firstPage;\n\t}\n\n\t/**\n\t * Get a PageList result from a EpubCFI\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} page\n\t */\n\tpageFromCfi(cfi){\n\t\tvar pg = -1;\n\n\t\t// Check if the pageList has not been set yet\n\t\tif(this.locations.length === 0) {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// TODO: check if CFI is valid?\n\n\t\t// check if the cfi is in the location list\n\t\t// var index = this.locations.indexOf(cfi);\n\t\tvar index = indexOfSorted(cfi, this.locations, this.epubcfi.compare);\n\t\tif(index != -1) {\n\t\t\tpg = this.pages[index];\n\t\t} else {\n\t\t\t// Otherwise add it to the list of locations\n\t\t\t// Insert it in the correct position in the locations page\n\t\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\n\t\t\tindex = locationOf(cfi, this.locations, this.epubcfi.compare);\n\t\t\t// Get the page at the location just before the new one, or return the first\n\t\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\n\t\t\tif(pg !== undefined) {\n\t\t\t\t// Add the new page in so that the locations and page array match up\n\t\t\t\t//this.pages.splice(index, 0, pg);\n\t\t\t} else {\n\t\t\t\tpg = -1;\n\t\t\t}\n\n\t\t}\n\t\treturn pg;\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Page List Item\n\t * @param  {string | number} pg\n\t * @return {string} cfi\n\t */\n\tcfiFromPage(pg){\n\t\tvar cfi = -1;\n\t\t// check that pg is an int\n\t\tif(typeof pg != \"number\"){\n\t\t\tpg = parseInt(pg);\n\t\t}\n\n\t\t// check if the cfi is in the page list\n\t\t// Pages could be unsorted.\n\t\tvar index = this.pages.indexOf(pg);\n\t\tif(index != -1) {\n\t\t\tcfi = this.locations[index];\n\t\t}\n\t\t// TODO: handle pages not in the list\n\t\treturn cfi;\n\t}\n\n\t/**\n\t * Get a Page from Book percentage\n\t * @param  {number} percent\n\t * @return {number} page\n\t */\n\tpageFromPercentage(percent){\n\t\tvar pg = Math.round(this.totalPages * percent);\n\t\treturn pg;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a page\n\t * @param  {number} pg the page\n\t * @return {number} percentage\n\t */\n\tpercentageFromPage(pg){\n\t\tvar percentage = (pg - this.firstPage) / this.totalPages;\n\t\treturn Math.round(percentage * 1000) / 1000;\n\t}\n\n\t/**\n\t * Returns a value between 0 - 1 corresponding to the location of a cfi\n\t * @param  {string} cfi EpubCFI String\n\t * @return {number} percentage\n\t */\n\tpercentageFromCfi(cfi){\n\t\tvar pg = this.pageFromCfi(cfi);\n\t\tvar percentage = this.percentageFromPage(pg);\n\t\treturn percentage;\n\t}\n\n\t/**\n\t * Destroy\n\t */\n\tdestroy() {\n\t\tthis.pages = undefined;\n\t\tthis.locations = undefined;\n\t\tthis.epubcfi = undefined;\n\n\t\tthis.pageList = undefined;\n\n\t\tthis.toc = undefined;\n\t\tthis.ncx = undefined;\n\t}\n}\n\nexport default PageList;\n"],"names":["PageList","xml","EpubCFI","html","qs","ncx","navHtml","navElement","querySelectorByType","navItems","qsa","length","i","list","item","navXml","pageList","pageTargets","navLabel","navLabelText","pageText","content","href","page","text","isCfi","split","packageUrl","cfi","pg","index","indexOfSorted","locationOf","percent","percentage"],"mappings":"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","x_google_ignoreList":[0]}