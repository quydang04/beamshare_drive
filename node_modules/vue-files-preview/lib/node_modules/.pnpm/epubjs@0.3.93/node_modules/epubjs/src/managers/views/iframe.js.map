{"version":3,"file":"iframe.js","sources":["../../../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/managers/views/iframe.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : \"\",\n\t\t\taxis: undefined, //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n\t\t\tdirection: undefined,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t\tmethod: undefined,\n\t\t\tforceRight: false,\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\t// this.width  = this.settings.width;\n\t\t// this.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis.pane = undefined;\n\t\tthis.highlights = {};\n\t\tthis.underlines = {};\n\t\tthis.marks = {};\n\n\t}\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement(\"div\");\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\t\telement.style.position = \"relative\";\n\t\telement.style.display = \"block\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.flex = \"none\";\n\t\t} else {\n\t\t\telement.style.flex = \"initial\";\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement(\"iframe\");\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\t// sandbox\n\t\tthis.iframe.sandbox = \"allow-same-origin\";\n\t\tif (this.settings.allowScriptedContent) {\n\t\t\tthis.iframe.sandbox += \" allow-scripts\";\n\t\t}\n\t\tif (this.settings.allowPopups) {\n\t\t\tthis.iframe.sandbox += \" allow-popups\";\n\t\t}\n\t\t\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.setAttribute(\"ref\", this.index);\n\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\n\t\tif((\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\tif (!this.settings.method) {\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n\t\t}\n\n\t\treturn this.iframe;\n\t}\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// find and report the writingMode axis\n\t\t\t\tlet writingMode = this.contents.writingMode();\n\n\t\t\t\t// Set the axis based on the flow and writing mode\n\t\t\t\tlet axis;\n\t\t\t\tif (this.settings.flow === \"scrolled\") {\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"horizontal\" : \"vertical\";\n\t\t\t\t} else {\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\t\t\t\t}\n\n\t\t\t\tif (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\n\t\t\t\t\tthis.layout.delta = this.layout.height;\n\t\t\t\t}\n\n\t\t\t\tthis.setAxis(axis);\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\n\n\t\t\t\tthis.setWritingMode(writingMode);\n\t\t\t\tthis.emit(EVENTS.VIEWS.WRITING_MODE, writingMode);\n\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\tthis.layout.format(this.contents, this.section, this.axis);\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\t\tthis.expand();\n\n\t\t\t\t\tif (this.settings.forceRight) {\n\t\t\t\t\t\tthis.element.style.marginLeft = this.width() + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t}.bind(this), function(e){\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.then(function() {\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\n\t\t\t}.bind(this));\n\n\t}\n\n\treset () {\n\t\tif (this.iframe) {\n\t\t\tthis.iframe.style.width = \"0\";\n\t\t\tthis.iframe.style.height = \"0\";\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._textWidth = undefined;\n\t\t\tthis._contentWidth = undefined;\n\t\t\tthis._textHeight = undefined;\n\t\t\tthis._contentHeight = undefined;\n\t\t}\n\t\tthis._needsReframe = true;\n\t}\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t\tthis.settings.width = width;\n\t\tthis.settings.height = height;\n\t}\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t// this.contents.layout();\n\t\t\tthis.expand();\n\t\t}\n\n\n\n\t}\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\twidth = this.layout.columnWidth;\n\t\t\theight = this.layout.height;\n\t\t}\n\t\t// Expand Horizontally\n\t\telse if(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\twidth = this.contents.textWidth();\n\n\t\t\tif (width % this.layout.pageWidth > 0) {\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n\t\t\t}\n\n\t\t\tif (this.settings.forceEvenPages) {\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\n\t\t\t\tif ( this.layout.divisor > 1 &&\n\t\t\t\t\t\t this.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t// add a blank page\n\t\t\t\t\twidth += this.layout.pageWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\theight = this.contents.textHeight();\n\t\t\tif (this.settings.flow === \"paginated\" &&\n\t\t\t\theight % this.layout.height > 0) {\n\t\t\t\theight = Math.ceil(height / this.layout.height) * this.layout.height;\n\t\t\t}\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.reframe(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t}\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n\t\tsize = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\twidthDelta: widthDelta,\n\t\t\theightDelta: heightDelta,\n\t\t};\n\n\t\tthis.pane && this.pane.render();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tlet mark;\n\t\t\tfor (let m in this.marks) {\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\n\t\t\t\t\tmark = this.marks[m];\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\n\n\t\tthis.prevBounds = size;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t}\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif (this.settings.method === \"blobUrl\") {\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n\t\t\tthis.iframe.src = this.blobUrl;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else if(this.settings.method === \"srcdoc\"){\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else {\n\n\t\t\tthis.element.appendChild(this.iframe);\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\t// For Cordova windows platform\n\t\t\tif(window.MSApp && MSApp.execUnsafeLocalFunction) {\n\t\t\t\tvar outerThis = this;\n\t\t\t\tMSApp.execUnsafeLocalFunction(function () {\n\t\t\t\t\touterThis.iframe.contentDocument.write(contents);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\t}\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\tonLoad(event, promise) {\n\n\t\tthis.window = this.iframe.contentWindow;\n\t\tthis.document = this.iframe.contentDocument;\n\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n\n\t\tthis.rendering = false;\n\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\tif (link) {\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t} else {\n\t\t\tlink = this.document.createElement(\"link\");\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t}\n\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpromise.resolve(this.contents);\n\t}\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\n\t\tif (this.contents) {\n\t\t\tthis.layout.format(this.contents);\n\t\t\tthis.expand();\n\t\t}\n\t}\n\n\tsetAxis(axis) {\n\n\t\tthis.settings.axis = axis;\n\n\t\tif(axis == \"horizontal\"){\n\t\t\tthis.element.style.flex = \"none\";\n\t\t} else {\n\t\t\tthis.element.style.flex = \"initial\";\n\t\t}\n\n\t\tthis.size();\n\n\t}\n\n\tsetWritingMode(mode) {\n\t\t// this.element.style.writingMode = writingMode;\n\t\tthis.writingMode = mode;\n\t}\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t}\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t}\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\n\t\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\t\tthis.displayed = true;\n\t\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t\t}.bind(this), function (err) {\n\t\t\t\t\tdisplayed.reject(err, this);\n\t\t\t\t});\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t}\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\n\t\t\t// Remind Safari to redraw the iframe\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\n\t\t\tthis.iframe.offsetWidth;\n\t\t\tthis.iframe.style.transform = null;\n\t\t}\n\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\n\t}\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\n\t}\n\n\toffset() {\n\t\treturn {\n\t\t\ttop: this.element.offsetTop,\n\t\t\tleft: this.element.offsetLeft\n\t\t}\n\t}\n\n\twidth() {\n\t\treturn this._width;\n\t}\n\n\theight() {\n\t\treturn this._height;\n\t}\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t}\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": targetPos.left,\n\t\t\t\"top\": targetPos.top\n\t\t};\n\t}\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tbounds(force) {\n\t\tif(force || !this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\n\t\treturn this.elementBounds;\n\t}\n\n\thighlight(cfiRange, data={}, cb, className = \"epubjs-hl\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"fill\": \"yellow\", \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Highlight(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tunderline(cfiRange, data={}, cb, className = \"epubjs-ul\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Underline(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tmark(cfiRange, data={}, cb) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cfiRange in this.marks) {\n\t\t\tlet item = this.marks[cfiRange];\n\t\t\treturn item;\n\t\t}\n\n\t\tlet range = this.contents.range(cfiRange);\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = range.commonAncestorContainer;\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\n\n\t\tlet emitter = (e) => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tif (range.collapsed && container.nodeType === 1) {\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(container);\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(parent);\n\t\t}\n\n\t\tlet mark = this.document.createElement(\"a\");\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\n\t\tmark.style.position = \"absolute\";\n\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\n\n\t\tif (data) {\n\t\t\tObject.keys(data).forEach((key) => {\n\t\t\t\tmark.dataset[key] = data[key];\n\t\t\t});\n\t\t}\n\n\t\tif (cb) {\n\t\t\tmark.addEventListener(\"click\", cb);\n\t\t\tmark.addEventListener(\"touchstart\", cb);\n\t\t}\n\n\t\tmark.addEventListener(\"click\", emitter);\n\t\tmark.addEventListener(\"touchstart\", emitter);\n\n\t\tthis.placeMark(mark, range);\n\n\t\tthis.element.appendChild(mark);\n\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\n\n\t\treturn parent;\n\t}\n\n\tplaceMark(element, range) {\n\t\tlet top, right, left;\n\n\t\tif(this.layout.name === \"pre-paginated\" ||\n\t\t\tthis.settings.axis !== \"horizontal\") {\n\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\ttop = pos.top;\n\t\t\tright = pos.right;\n\t\t} else {\n\t\t\t// Element might break columns, so find the left most element\n\t\t\tlet rects = range.getClientRects();\n\n\t\t\tlet rect;\n\t\t\tfor (var i = 0; i != rects.length; i++) {\n\t\t\t\trect = rects[i];\n\t\t\t\tif (!left || rect.left < left) {\n\t\t\t\t\tleft = rect.left;\n\t\t\t\t\t// right = rect.right;\n\t\t\t\t\tright = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - (this.layout.gap / 2);\n\t\t\t\t\ttop = rect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.style.top = `${top}px`;\n\t\telement.style.left = `${right}px`;\n\t}\n\n\tunhighlight(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.highlights) {\n\t\t\titem = this.highlights[cfiRange];\n\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.highlights[cfiRange];\n\t\t}\n\t}\n\n\tununderline(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.underlines) {\n\t\t\titem = this.underlines[cfiRange];\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.underlines[cfiRange];\n\t\t}\n\t}\n\n\tunmark(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.marks) {\n\t\t\titem = this.marks[cfiRange];\n\t\t\tthis.element.removeChild(item.element);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.marks[cfiRange];\n\t\t}\n\t}\n\n\tdestroy() {\n\n\t\tfor (let cfiRange in this.highlights) {\n\t\t\tthis.unhighlight(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.underlines) {\n\t\t\tthis.ununderline(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.marks) {\n\t\t\tthis.unmark(cfiRange);\n\t\t}\n\n\t\tif (this.blobUrl) {\n\t\t\trevokeBlobUrl(this.blobUrl);\n\t\t}\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\t\t\tthis.contents.destroy();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\n\t\t\tif (this.pane) {\n\t\t\t\tthis.pane.element.remove();\n\t\t\t\tthis.pane = undefined;\n\t\t\t}\n\n\t\t\tthis.iframe = undefined;\n\t\t\tthis.contents = undefined;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t}\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n"],"names":["IframeView","section","options","extend","uuid","EpubCFI","axis","element","bounds","request","show","contents","writingMode","EVENTS","resolve","reject","e","_width","_height","width","height","what","elBorders","borders","iframeBorders","isNumber","force","columns","size","widthDelta","heightDelta","mark","m","loading","defer","loaded","event","createBlobUrl","outerThis","promise","Contents","link","layout","mode","layoutFunc","displayed","err","target","targetPos","view","cfiRange","data","cb","className","styles","attributes","range","emitter","Pane","Highlight","h","Underline","container","parent","key","top","right","left","pos","rects","rect","i","item","l","revokeBlobUrl","EventEmitter"],"mappings":"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","x_google_ignoreList":[0]}