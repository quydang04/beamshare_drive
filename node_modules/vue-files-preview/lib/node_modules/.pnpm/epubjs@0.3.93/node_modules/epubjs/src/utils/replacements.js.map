{"version":3,"file":"replacements.js","sources":["../../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/utils/replacements.js"],"sourcesContent":["import { qs, qsa } from \"./core\";\nimport Url from \"./url\";\nimport Path from \"./path\";\n\nexport function replaceBase(doc, section){\n\tvar base;\n\tvar head;\n\tvar url = section.url;\n\tvar absolute = (url.indexOf(\"://\") > -1);\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tbase = qs(head, \"base\");\n\n\tif(!base) {\n\t\tbase = doc.createElement(\"base\");\n\t\thead.insertBefore(base, head.firstChild);\n\t}\n\n\t// Fix for Safari crashing if the url doesn't have an origin\n\tif (!absolute && window && window.location) {\n\t\turl = window.location.origin + url;\n\t}\n\n\tbase.setAttribute(\"href\", url);\n}\n\nexport function replaceCanonical(doc, section){\n\tvar head;\n\tvar link;\n\tvar url = section.canonical;\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tlink = qs(head, \"link[rel='canonical']\");\n\n\tif (link) {\n\t\tlink.setAttribute(\"href\", url);\n\t} else {\n\t\tlink = doc.createElement(\"link\");\n\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\tlink.setAttribute(\"href\", url);\n\t\thead.appendChild(link);\n\t}\n}\n\nexport function replaceMeta(doc, section){\n\tvar head;\n\tvar meta;\n\tvar id = section.idref;\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tmeta = qs(head, \"link[property='dc.identifier']\");\n\n\tif (meta) {\n\t\tmeta.setAttribute(\"content\", id);\n\t} else {\n\t\tmeta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.identifier\");\n\t\tmeta.setAttribute(\"content\", id);\n\t\thead.appendChild(meta);\n\t}\n}\n\n// TODO: move me to Contents\nexport function replaceLinks(contents, fn) {\n\n\tvar links = contents.querySelectorAll(\"a[href]\");\n\n\tif (!links.length) {\n\t\treturn;\n\t}\n\n\tvar base = qs(contents.ownerDocument, \"base\");\n\tvar location = base ? base.getAttribute(\"href\") : undefined;\n\tvar replaceLink = function(link){\n\t\tvar href = link.getAttribute(\"href\");\n\n\t\tif(href.indexOf(\"mailto:\") === 0){\n\t\t\treturn;\n\t\t}\n\n\t\tvar absolute = (href.indexOf(\"://\") > -1);\n\n\t\tif(absolute){\n\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\n\n\t\t}else{\n\t\t\tvar linkUrl;\n\t\t\ttry {\n\t\t\t\tlinkUrl = new Url(href, location);\t\n\t\t\t} catch(error) {\n\t\t\t\t// NOOP\n\t\t\t}\n\n\t\t\tlink.onclick = function(){\n\n\t\t\t\tif(linkUrl && linkUrl.hash) {\n\t\t\t\t\tfn(linkUrl.Path.path + linkUrl.hash);\n\t\t\t\t} else if(linkUrl){\n\t\t\t\t\tfn(linkUrl.Path.path);\n\t\t\t\t} else {\n\t\t\t\t\tfn(href);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t}.bind(this);\n\n\tfor (var i = 0; i < links.length; i++) {\n\t\treplaceLink(links[i]);\n\t}\n\n\n}\n\nexport function substitute(content, urls, replacements) {\n\turls.forEach(function(url, i){\n\t\tif (url && replacements[i]) {\n\t\t\t// Account for special characters in the file name.\n\t\t\t// See https://stackoverflow.com/a/6318729.\n\t\t\turl = url.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n\t\t\tcontent = content.replace(new RegExp(url, \"g\"), replacements[i]);\n\t\t}\n\t});\n\treturn content;\n}\n"],"names":["replaceBase","doc","section","base","head","url","absolute","qs","replaceCanonical","link","replaceMeta","meta","id","replaceLinks","contents","fn","links","location","replaceLink","href","linkUrl","Url","i","substitute","content","urls","replacements"],"mappings":"mIAIO,SAASA,EAAYC,EAAKC,EAAQ,CACxC,IAAIC,EACAC,EACAC,EAAMH,EAAQ,IACdI,EAAYD,EAAI,QAAQ,KAAK,EAAI,GAEjCJ,IAIJG,EAAOG,EAAE,GAACN,EAAK,MAAM,EACrBE,EAAOI,EAAE,GAACH,EAAM,MAAM,EAElBD,IACHA,EAAOF,EAAI,cAAc,MAAM,EAC/BG,EAAK,aAAaD,EAAMC,EAAK,UAAU,GAIpC,CAACE,GAAY,QAAU,OAAO,WACjCD,EAAM,OAAO,SAAS,OAASA,GAGhCF,EAAK,aAAa,OAAQE,CAAG,EAC9B,CAEO,SAASG,EAAiBP,EAAKC,EAAQ,CAC7C,IAAIE,EACAK,EACAJ,EAAMH,EAAQ,UAEdD,IAIJG,EAAOG,EAAE,GAACN,EAAK,MAAM,EACrBQ,EAAOF,EAAE,GAACH,EAAM,uBAAuB,EAEnCK,EACHA,EAAK,aAAa,OAAQJ,CAAG,GAE7BI,EAAOR,EAAI,cAAc,MAAM,EAC/BQ,EAAK,aAAa,MAAO,WAAW,EACpCA,EAAK,aAAa,OAAQJ,CAAG,EAC7BD,EAAK,YAAYK,CAAI,GAEvB,CAEO,SAASC,EAAYT,EAAKC,EAAQ,CACxC,IAAIE,EACAO,EACAC,EAAKV,EAAQ,MACbD,IAIJG,EAAOG,EAAE,GAACN,EAAK,MAAM,EACrBU,EAAOJ,EAAE,GAACH,EAAM,gCAAgC,EAE5CO,EACHA,EAAK,aAAa,UAAWC,CAAE,GAE/BD,EAAOV,EAAI,cAAc,MAAM,EAC/BU,EAAK,aAAa,OAAQ,eAAe,EACzCA,EAAK,aAAa,UAAWC,CAAE,EAC/BR,EAAK,YAAYO,CAAI,GAEvB,CAGO,SAASE,EAAaC,EAAUC,EAAI,CAE1C,IAAIC,EAAQF,EAAS,iBAAiB,SAAS,EAE/C,GAAKE,EAAM,OA0CX,QAtCIb,EAAOI,EAAE,GAACO,EAAS,cAAe,MAAM,EACxCG,EAAWd,EAAOA,EAAK,aAAa,MAAM,EAAI,OAC9Ce,GAAc,SAAST,EAAK,CAC/B,IAAIU,EAAOV,EAAK,aAAa,MAAM,EAEnC,GAAGU,EAAK,QAAQ,SAAS,IAAM,EAI/B,KAAIb,EAAYa,EAAK,QAAQ,KAAK,EAAI,GAEtC,GAAGb,EAEFG,EAAK,aAAa,SAAU,QAAQ,MAEhC,CACJ,IAAIW,EACJ,GAAI,CACHA,EAAU,IAAIC,EAAIF,EAAMF,CAAQ,CAChC,MAAc,CAEd,CAEDR,EAAK,QAAU,UAAU,CAExB,OAAGW,GAAWA,EAAQ,KACrBL,EAAGK,EAAQ,KAAK,KAAOA,EAAQ,IAAI,EAEnCL,EADSK,EACNA,EAAQ,KAAK,KAEbD,CAFiB,EAKd,EACX,CACG,EACH,GAAG,KAAK,IAAI,EAEFG,EAAI,EAAGA,EAAIN,EAAM,OAAQM,IACjCJ,EAAYF,EAAMM,CAAC,CAAC,CAItB,CAEO,SAASC,EAAWC,EAASC,EAAMC,EAAc,CACvD,OAAAD,EAAK,QAAQ,SAASpB,EAAKiB,EAAE,CACxBjB,GAAOqB,EAAaJ,CAAC,IAGxBjB,EAAMA,EAAI,QAAQ,2BAA4B,MAAM,EACpDmB,EAAUA,EAAQ,QAAQ,IAAI,OAAOnB,EAAK,GAAG,EAAGqB,EAAaJ,CAAC,CAAC,EAElE,CAAE,EACME,CACR","x_google_ignoreList":[0]}