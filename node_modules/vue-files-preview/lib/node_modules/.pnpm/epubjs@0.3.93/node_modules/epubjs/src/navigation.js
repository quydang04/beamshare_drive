"use strict";const l=require("./utils/core.js");class f{constructor(t){this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,t&&this.parse(t)}parse(t){let e=t.nodeType,r,i;e&&(r=l.qs(t,"html"),i=l.qs(t,"ncx")),e?r?(this.toc=this.parseNav(t),this.landmarks=this.parseLandmarks(t)):i&&(this.toc=this.parseNcx(t)):this.toc=this.load(t),this.length=0,this.unpack(this.toc)}unpack(t){for(var e,r=0;r<t.length;r++)e=t[r],e.href&&(this.tocByHref[e.href]=r),e.id&&(this.tocById[e.id]=r),this.length++,e.subitems.length&&this.unpack(e.subitems)}get(t){var e;return t?(t.indexOf("#")===0?e=this.tocById[t.substring(1)]:t in this.tocByHref&&(e=this.tocByHref[t]),this.getByIndex(t,e,this.toc)):this.toc}getByIndex(t,e,r){if(r.length===0)return;const i=r[e];if(i&&(t===i.id||t===i.href))return i;{let n;for(let a=0;a<r.length&&(n=this.getByIndex(t,e,r[a].subitems),!n);++a);return n}}landmark(t){var e;return t?(e=this.landmarksByType[t],this.landmarks[e]):this.landmarks}parseNav(t){var e=l.querySelectorByType(t,"nav","toc"),r=[];if(!e)return r;let i=l.filterChildren(e,"ol",!0);return i&&(r=this.parseNavList(i)),r}parseNavList(t,e){const r=[];if(!t||!t.children)return r;for(let i=0;i<t.children.length;i++){const n=this.navItem(t.children[i],e);n&&r.push(n)}return r}navItem(t,e){let r=t.getAttribute("id")||void 0,i=l.filterChildren(t,"a",!0)||l.filterChildren(t,"span",!0);if(!i)return;let n=i.getAttribute("href")||"";r||(r=n);let a=i.textContent||"",s=[],h=l.filterChildren(t,"ol",!0);return h&&(s=this.parseNavList(h,r)),{id:r,href:n,label:a,subitems:s,parent:e}}parseLandmarks(t){var e=l.querySelectorByType(t,"nav","landmarks"),r=e?l.qsa(e,"li"):[],i=r.length,n,a=[],s;if(!r||i===0)return a;for(n=0;n<i;++n)s=this.landmarkItem(r[n]),s&&(a.push(s),this.landmarksByType[s.type]=n);return a}landmarkItem(t){let e=l.filterChildren(t,"a",!0);if(!e)return;let r=e.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0,i=e.getAttribute("href")||"",n=e.textContent||"";return{href:i,label:n,type:r}}parseNcx(t){var e=l.qsa(t,"navPoint"),r=e.length,i,n={},a=[],s,h;if(!e||r===0)return a;for(i=0;i<r;++i)s=this.ncxItem(e[i]),n[s.id]=s,s.parent?(h=n[s.parent],h.subitems.push(s)):a.push(s);return a}ncxItem(t){var e=t.getAttribute("id")||!1,r=l.qs(t,"content"),i=r.getAttribute("src"),n=l.qs(t,"navLabel"),a=n.textContent?n.textContent:"",s=[],h=t.parentNode,u;return h&&(h.nodeName==="navPoint"||h.nodeName.split(":").slice(-1)[0]==="navPoint")&&(u=h.getAttribute("id")),{id:e,href:i,label:a,subitems:s,parent:u}}load(t){return t.map(e=>(e.label=e.title,e.subitems=e.children?this.load(e.children):[],e))}forEach(t){return this.toc.forEach(t)}}module.exports=f;
//# sourceMappingURL=navigation.js.map
