"use strict";const n=require("./core.js"),d=require("./path.js");function v(a,e,h,p){var f=typeof window<"u"?window.URL:!1,l=f?"blob":"arraybuffer",r=new n.defer,s=new XMLHttpRequest,u=XMLHttpRequest.prototype,o;"overrideMimeType"in u||Object.defineProperty(u,"overrideMimeType",{value:function(){}}),h&&(s.withCredentials=!0),s.onreadystatechange=m,s.onerror=c,s.open("GET",a,!0);for(o in p)s.setRequestHeader(o,p[o]);e=="json"&&s.setRequestHeader("Accept","application/json"),e||(e=new d(a).extension),e=="blob"&&(s.responseType=l),n.isXml(e)&&s.overrideMimeType("text/xml"),e=="binary"&&(s.responseType="arraybuffer"),s.send();function c(i){r.reject(i)}function m(){if(this.readyState===XMLHttpRequest.DONE){var i=!1;if((this.responseType===""||this.responseType==="document")&&(i=this.responseXML),this.status===200||this.status===0||i){var t;if(!this.response&&!i)return r.reject({status:this.status,message:"Empty Response",stack:new Error().stack}),r.promise;if(this.status===403)return r.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack}),r.promise;i?t=this.responseXML:n.isXml(e)?t=n.parse(this.response,"text/xml"):e=="xhtml"?t=n.parse(this.response,"application/xhtml+xml"):e=="html"||e=="htm"?t=n.parse(this.response,"text/html"):e=="json"?t=JSON.parse(this.response):e=="blob"?f?t=this.response:t=new Blob([this.response]):t=this.response,r.resolve(t)}else r.reject({status:this.status,message:this.response,stack:new Error().stack})}}return r.promise}module.exports=v;
//# sourceMappingURL=request.js.map
