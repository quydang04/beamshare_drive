{"version":3,"file":"stage.js","sources":["../../../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/managers/helpers/stage.js"],"sourcesContent":["import {uuid, isNumber, isElement, windowBounds, extend} from \"../../utils/core\";\nimport throttle from 'lodash/throttle'\n\nclass Stage {\n\tconstructor(_options) {\n\t\tthis.settings = _options || {};\n\t\tthis.id = \"epubjs-container-\" + uuid();\n\n\t\tthis.container = this.create(this.settings);\n\n\t\tif(this.settings.hidden) {\n\t\t\tthis.wrapper = this.wrap(this.container);\n\t\t}\n\n\t}\n\n\t/*\n\t* Creates an element to render to.\n\t* Resizes to passed width and height or to the elements size\n\t*/\n\tcreate(options){\n\t\tlet height  = options.height;// !== false ? options.height : \"100%\";\n\t\tlet width   = options.width;// !== false ? options.width : \"100%\";\n\t\tlet overflow  = options.overflow || false;\n\t\tlet axis = options.axis || \"vertical\";\n\t\tlet direction = options.direction;\n\n\t\textend(this.settings, options);\n\n\t\tif(options.height && isNumber(options.height)) {\n\t\t\theight = options.height + \"px\";\n\t\t}\n\n\t\tif(options.width && isNumber(options.width)) {\n\t\t\twidth = options.width + \"px\";\n\t\t}\n\n\t\t// Create new container element\n\t\tlet container = document.createElement(\"div\");\n\n\t\tcontainer.id = this.id;\n\t\tcontainer.classList.add(\"epub-container\");\n\n\t\t// Style Element\n\t\t// container.style.fontSize = \"0\";\n\t\tcontainer.style.wordSpacing = \"0\";\n\t\tcontainer.style.lineHeight = \"0\";\n\t\tcontainer.style.verticalAlign = \"top\";\n\t\tcontainer.style.position = \"relative\";\n\n\t\tif(axis === \"horizontal\") {\n\t\t\t// container.style.whiteSpace = \"nowrap\";\n\t\t\tcontainer.style.display = \"flex\";\n\t\t\tcontainer.style.flexDirection = \"row\";\n\t\t\tcontainer.style.flexWrap = \"nowrap\";\n\t\t}\n\n\t\tif(width){\n\t\t\tcontainer.style.width = width;\n\t\t}\n\n\t\tif(height){\n\t\t\tcontainer.style.height = height;\n\t\t}\n\n\t\tif (overflow) {\n\t\t\tif (overflow === \"scroll\" && axis === \"vertical\") {\n\t\t\t\tcontainer.style[\"overflow-y\"] = overflow;\n\t\t\t\tcontainer.style[\"overflow-x\"] = \"hidden\";\n\t\t\t} else if (overflow === \"scroll\" && axis === \"horizontal\") {\n\t\t\t\tcontainer.style[\"overflow-y\"] = \"hidden\";\n\t\t\t\tcontainer.style[\"overflow-x\"] = overflow;\n\t\t\t} else {\n\t\t\t\tcontainer.style[\"overflow\"] = overflow;\n\t\t\t}\n\t\t}\n\n\t\tif (direction) {\n\t\t\tcontainer.dir = direction;\n\t\t\tcontainer.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (direction && this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = direction;\n\t\t}\n\n\t\treturn container;\n\t}\n\n\twrap(container) {\n\t\tvar wrapper = document.createElement(\"div\");\n\n\t\twrapper.style.visibility = \"hidden\";\n\t\twrapper.style.overflow = \"hidden\";\n\t\twrapper.style.width = \"0\";\n\t\twrapper.style.height = \"0\";\n\n\t\twrapper.appendChild(container);\n\t\treturn wrapper;\n\t}\n\n\n\tgetElement(_element){\n\t\tvar element;\n\n\t\tif(isElement(_element)) {\n\t\t\telement = _element;\n\t\t} else if (typeof _element === \"string\") {\n\t\t\telement = document.getElementById(_element);\n\t\t}\n\n\t\tif(!element){\n\t\t\tthrow new Error(\"Not an Element\");\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tattachTo(what){\n\n\t\tvar element = this.getElement(what);\n\t\tvar base;\n\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.hidden) {\n\t\t\tbase = this.wrapper;\n\t\t} else {\n\t\t\tbase = this.container;\n\t\t}\n\n\t\telement.appendChild(base);\n\n\t\tthis.element = element;\n\n\t\treturn element;\n\n\t}\n\n\tgetContainer() {\n\t\treturn this.container;\n\t}\n\n\tonResize(func){\n\t\t// Only listen to window for resize event if width and height are not fixed.\n\t\t// This applies if it is set to a percent or auto.\n\t\tif(!isNumber(this.settings.width) ||\n\t\t\t !isNumber(this.settings.height) ) {\n\t\t\tthis.resizeFunc = throttle(func, 50);\n\t\t\twindow.addEventListener(\"resize\", this.resizeFunc, false);\n\t\t}\n\n\t}\n\n\tonOrientationChange(func){\n\t\tthis.orientationChangeFunc = func;\n\t\twindow.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\n\t}\n\n\tsize(width, height){\n\t\tvar bounds;\n\t\tlet _width = width || this.settings.width;\n\t\tlet _height = height || this.settings.height;\n\n\t\t// If width or height are set to false, inherit them from containing element\n\t\tif(width === null) {\n\t\t\tbounds = this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.width) {\n\t\t\t\twidth = Math.floor(bounds.width);\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.width = width;\n\t\t\t}\n\t\t}\n\n\t\tif(height === null) {\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.height) {\n\t\t\t\theight = bounds.height;\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.height = height;\n\t\t\t}\n\t\t}\n\n\t\tif(!isNumber(width)) {\n\t\t\twidth = this.container.clientWidth;\n\t\t}\n\n\t\tif(!isNumber(height)) {\n\t\t\theight = this.container.clientHeight;\n\t\t}\n\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\n\n\t\tthis.containerPadding = {\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\t// Bounds not set, get them from window\n\t\tlet _windowBounds = windowBounds();\n\t\tlet bodyStyles = window.getComputedStyle(document.body);\n\t\tlet bodyPadding = {\n\t\t\tleft: parseFloat(bodyStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(bodyStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(bodyStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\tif (!_width) {\n\t\t\twidth = _windowBounds.width -\n\t\t\t\t\t\t\t\tbodyPadding.left -\n\t\t\t\t\t\t\t\tbodyPadding.right;\n\t\t}\n\n\t\tif ((this.settings.fullsize && !_height) || !_height) {\n\t\t\theight = _windowBounds.height -\n\t\t\t\t\t\t\t\tbodyPadding.top -\n\t\t\t\t\t\t\t\tbodyPadding.bottom;\n\t\t}\n\n\t\treturn {\n\t\t\twidth: width -\n\t\t\t\t\t\t\tthis.containerPadding.left -\n\t\t\t\t\t\t\tthis.containerPadding.right,\n\t\t\theight: height -\n\t\t\t\t\t\t\tthis.containerPadding.top -\n\t\t\t\t\t\t\tthis.containerPadding.bottom\n\t\t};\n\n\t}\n\n\tbounds(){\n\t\tlet box;\n\t\tif (this.container.style.overflow !== \"visible\") {\n\t\t\tbox = this.container && this.container.getBoundingClientRect();\n\t\t}\n\n\t\tif(!box || !box.width || !box.height) {\n\t\t\treturn windowBounds();\n\t\t} else {\n\t\t\treturn box;\n\t\t}\n\n\t}\n\n\tgetSheet(){\n\t\tvar style = document.createElement(\"style\");\n\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\t\tstyle.appendChild(document.createTextNode(\"\"));\n\n\t\tdocument.head.appendChild(style);\n\n\t\treturn style.sheet;\n\t}\n\n\taddStyleRules(selector, rulesArray){\n\t\tvar scope = \"#\" + this.id + \" \";\n\t\tvar rules = \"\";\n\n\t\tif(!this.sheet){\n\t\t\tthis.sheet = this.getSheet();\n\t\t}\n\n\t\trulesArray.forEach(function(set) {\n\t\t\tfor (var prop in set) {\n\t\t\t\tif(set.hasOwnProperty(prop)) {\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n\t}\n\n\taxis(axis) {\n\t\tif(axis === \"horizontal\") {\n\t\t\tthis.container.style.display = \"flex\";\n\t\t\tthis.container.style.flexDirection = \"row\";\n\t\t\tthis.container.style.flexWrap = \"nowrap\";\n\t\t} else {\n\t\t\tthis.container.style.display = \"block\";\n\t\t}\n\t\tthis.settings.axis = axis;\n\t}\n\n\t// orientation(orientation) {\n\t// \tif (orientation === \"landscape\") {\n\t//\n\t// \t} else {\n\t//\n\t// \t}\n\t//\n\t// \tthis.orientation = orientation;\n\t// }\n\n\tdirection(dir) {\n\t\tif (this.container) {\n\t\t\tthis.container.dir = dir;\n\t\t\tthis.container.style[\"direction\"] = dir;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = dir;\n\t\t}\n\t\tthis.settings.dir = dir;\n\t}\n\n\toverflow(overflow) {\n\t\tif (this.container) {\n\t\t\tif (overflow === \"scroll\" && this.settings.axis === \"vertical\") {\n\t\t\t\tthis.container.style[\"overflow-y\"] = overflow;\n\t\t\t\tthis.container.style[\"overflow-x\"] = \"hidden\";\n\t\t\t} else if (overflow === \"scroll\" && this.settings.axis === \"horizontal\") {\n\t\t\t\tthis.container.style[\"overflow-y\"] = \"hidden\";\n\t\t\t\tthis.container.style[\"overflow-x\"] = overflow;\n\t\t\t} else {\n\t\t\t\tthis.container.style[\"overflow\"] = overflow;\n\t\t\t}\n\t\t}\n\t\tthis.settings.overflow = overflow;\n\t}\n\n\tdestroy() {\n\t\tvar base;\n\n\t\tif (this.element) {\n\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tbase = this.wrapper;\n\t\t\t} else {\n\t\t\t\tbase = this.container;\n\t\t\t}\n\n\t\t\tif(this.element.contains(this.container)) {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\n\t\t\twindow.removeEventListener(\"resize\", this.resizeFunc);\n\t\t\twindow.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\n\n\t\t}\n\t}\n}\n\nexport default Stage;\n"],"names":["Stage","_options","uuid","options","height","width","overflow","axis","direction","extend","isNumber","container","wrapper","_element","element","isElement","what","base","func","throttle","bounds","_width","_height","_windowBounds","windowBounds","bodyStyles","bodyPadding","box","style","selector","rulesArray","scope","rules","set","prop","dir"],"mappings":"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","x_google_ignoreList":[0]}