"use strict";const f=require("./epubcfi.js"),n=require("./utils/core.js");class c{constructor(t){this.pages=[],this.locations=[],this.epubcfi=new f,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,t&&(this.pageList=this.parse(t)),this.pageList&&this.pageList.length&&this.process(this.pageList)}parse(t){var e=n.qs(t,"html"),s=n.qs(t,"ncx");if(e)return this.parseNav(t);if(s)return this.parseNcx(t)}parseNav(t){var e=n.querySelectorByType(t,"nav","page-list"),s=e?n.qsa(e,"li"):[],h=s.length,a,i=[],r;if(!s||h===0)return i;for(a=0;a<h;++a)r=this.item(s[a]),i.push(r);return i}parseNcx(t){var e=[],s=0,h,a,i,r=0;if(a=n.qs(t,"pageList"),!a||(i=n.qsa(a,"pageTarget"),r=i.length,!i||i.length===0))return e;for(s=0;s<r;++s)h=this.ncxItem(i[s]),e.push(h);return e}ncxItem(t){var e=n.qs(t,"navLabel"),s=n.qs(e,"text"),h=s.textContent,a=n.qs(t,"content"),i=a.getAttribute("src"),r=parseInt(h,10);return{href:i,page:r}}item(t){var e=n.qs(t,"a"),s=e.getAttribute("href")||"",h=e.textContent||"",a=parseInt(h),i=s.indexOf("epubcfi"),r,p,g;return i!=-1?(r=s.split("#"),p=r[0],g=r.length>1?r[1]:!1,{cfi:g,href:s,packageUrl:p,page:a}):{href:s,page:a}}process(t){t.forEach(function(e){this.pages.push(e.page),e.cfi&&this.locations.push(e.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(t){var e=-1;if(this.locations.length===0)return-1;var s=n.indexOfSorted(t,this.locations,this.epubcfi.compare);return s!=-1?e=this.pages[s]:(s=n.locationOf(t,this.locations,this.epubcfi.compare),e=s-1>=0?this.pages[s-1]:this.pages[0],e!==void 0||(e=-1)),e}cfiFromPage(t){var e=-1;typeof t!="number"&&(t=parseInt(t));var s=this.pages.indexOf(t);return s!=-1&&(e=this.locations[s]),e}pageFromPercentage(t){var e=Math.round(this.totalPages*t);return e}percentageFromPage(t){var e=(t-this.firstPage)/this.totalPages;return Math.round(e*1e3)/1e3}percentageFromCfi(t){var e=this.pageFromCfi(t),s=this.percentageFromPage(e);return s}destroy(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}module.exports=c;
//# sourceMappingURL=pagelist.js.map
