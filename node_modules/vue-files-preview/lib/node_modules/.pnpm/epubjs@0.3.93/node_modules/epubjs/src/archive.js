"use strict";const o=require("./utils/core.js"),d=require("./utils/request.js"),c=require("./utils/mime.js"),l=require("./utils/path.js"),u=require("../../../../jszip@3.10.1/node_modules/jszip/dist/jszip.js");class f{constructor(){this.zip=void 0,this.urlCache={},this.checkRequirements()}checkRequirements(){try{this.zip=new u}catch{throw new Error("JSZip lib not loaded")}}open(e,t){return this.zip.loadAsync(e,{base64:t})}openUrl(e,t){return d(e,"binary").then((function(r){return this.zip.loadAsync(r,{base64:t})}).bind(this))}request(e,t){var r=new o.defer,n,i=new l(e);return t||(t=i.extension),t=="blob"?n=this.getBlob(e):n=this.getText(e),n?n.then((function(s){let h=this.handleResponse(s,t);r.resolve(h)}).bind(this)):r.reject({message:"File not found in the epub: "+e,stack:new Error().stack}),r.promise}handleResponse(e,t){var r;return t=="json"?r=JSON.parse(e):o.isXml(t)?r=o.parse(e,"text/xml"):t=="xhtml"?r=o.parse(e,"application/xhtml+xml"):t=="html"||t=="htm"?r=o.parse(e,"text/html"):r=e,r}getBlob(e,t){var r=window.decodeURIComponent(e.substr(1)),n=this.zip.file(r);if(n)return t=t||c.lookup(n.name),n.async("uint8array").then(function(i){return new Blob([i],{type:t})})}getText(e,t){var r=window.decodeURIComponent(e.substr(1)),n=this.zip.file(r);if(n)return n.async("string").then(function(i){return i})}getBase64(e,t){var r=window.decodeURIComponent(e.substr(1)),n=this.zip.file(r);if(n)return t=t||c.lookup(n.name),n.async("base64").then(function(i){return"data:"+t+";base64,"+i})}createUrl(e,t){var r=new o.defer,n=window.URL||window.webkitURL||window.mozURL,i,s,h=t&&t.base64;return e in this.urlCache?(r.resolve(this.urlCache[e]),r.promise):(h?(s=this.getBase64(e),s&&s.then((function(a){this.urlCache[e]=a,r.resolve(a)}).bind(this))):(s=this.getBlob(e),s&&s.then((function(a){i=n.createObjectURL(a),this.urlCache[e]=i,r.resolve(i)}).bind(this))),s||r.reject({message:"File not found in the epub: "+e,stack:new Error().stack}),r.promise)}revokeUrl(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)}destroy(){var e=window.URL||window.webkitURL||window.mozURL;for(let t in this.urlCache)e.revokeObjectURL(t);this.zip=void 0,this.urlCache={}}}module.exports=f;
//# sourceMappingURL=archive.js.map
