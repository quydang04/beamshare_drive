{"version":3,"file":"core.js","sources":["../../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/utils/core.js"],"sourcesContent":["/**\n * Core Utilities and Helpers\n * @module Core\n*/\nimport { DOMParser as XMLDOMParser } from \"@xmldom/xmldom\";\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nexport const requestAnimationFrame = (typeof window != \"undefined\") ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\nconst _URL = typeof URL != \"undefined\" ? URL : (typeof window != \"undefined\" ? (window.URL || window.webkitURL || window.mozURL) : undefined);\n\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\nexport function uuid() {\n\tvar d = new Date().getTime();\n\tvar uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\td = Math.floor(d/16);\n\t\treturn (c==\"x\" ? r : (r&0x7|0x8)).toString(16);\n\t});\n\treturn uuid;\n}\n\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\nexport function documentHeight() {\n\treturn Math.max(\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight\n\t);\n}\n\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\nexport function isElement(obj) {\n\treturn !!(obj && obj.nodeType == 1);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isNumber(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isFloat(n) {\n\tlet f = parseFloat(n);\n\n\tif (isNumber(n) === false) {\n\t\treturn false;\n\t}\n\n\tif (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n\t\treturn true;\n\t}\n\n\treturn Math.floor(f) !== f;\n}\n\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\nexport function prefixed(unprefixed) {\n\tvar vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\" ];\n\tvar prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n\tvar lower = unprefixed.toLowerCase();\n\tvar length = vendors.length;\n\n\tif (typeof(document) === \"undefined\" || typeof(document.body.style[lower]) != \"undefined\") {\n\t\treturn unprefixed;\n\t}\n\n\tfor (var i = 0; i < length; i++) {\n\t\tif (typeof(document.body.style[prefixes[i] + lower]) != \"undefined\") {\n\t\t\treturn prefixes[i] + lower;\n\t\t}\n\t}\n\n\treturn unprefixed;\n}\n\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\nexport function defaults(obj) {\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\n\t\tvar source = arguments[i];\n\t\tfor (var prop in source) {\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\n\t\t}\n\t}\n\treturn obj;\n}\n\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\nexport function extend(target) {\n\tvar sources = [].slice.call(arguments, 1);\n\tsources.forEach(function (source) {\n\t\tif(!source) return;\n\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\n\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n\t\t});\n\t});\n\treturn target;\n}\n\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function insert(item, array, compareFunction) {\n\tvar location = locationOf(item, array, compareFunction);\n\tarray.splice(location, 0, item);\n\n\treturn location;\n}\n\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function locationOf(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn pivot;\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared >= 0 ? pivot : pivot + 1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot;\n\t}\n\tif(compared === -1) {\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\n\t}\n}\n\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn -1; // Not found\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared === 0 ? pivot : -1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot; // Found\n\t}\n\tif(compared === -1) {\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\n\t}\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function bounds(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function borders(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\nexport function nodeBounds(node) {\n\tlet elPos;\n\tlet doc = node.ownerDocument;\n\tif(node.nodeType == Node.TEXT_NODE){\n\t\tlet elRange = doc.createRange();\n\t\telRange.selectNodeContents(node);\n\t\telPos = elRange.getBoundingClientRect();\n\t} else {\n\t\telPos = node.getBoundingClientRect();\n\t}\n\treturn elPos;\n}\n\n/**\n * Find the equivalent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\nexport function windowBounds() {\n\n\tvar width = window.innerWidth;\n\tvar height = window.innerHeight;\n\n\treturn {\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tright: width,\n\t\tbottom: height,\n\t\twidth: width,\n\t\theight: height\n\t};\n\n}\n\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\nexport function indexOfNode(node, typeId) {\n\tvar parent = node.parentNode;\n\tvar children = parent.childNodes;\n\tvar sib;\n\tvar index = -1;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tsib = children[i];\n\t\tif (sib.nodeType === typeId) {\n\t\t\tindex++;\n\t\t}\n\t\tif (sib == node) break;\n\t}\n\n\treturn index;\n}\n\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfTextNode(textNode) {\n\treturn indexOfNode(textNode, TEXT_NODE);\n}\n\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfElementNode(elementNode) {\n\treturn indexOfNode(elementNode, ELEMENT_NODE);\n}\n\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\nexport function isXml(ext) {\n\treturn [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\nexport function createBlob(content, mime){\n\treturn new Blob([content], {type : mime });\n}\n\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBlobUrl(content, mime){\n\tvar tempUrl;\n\tvar blob = createBlob(content, mime);\n\n\ttempUrl = _URL.createObjectURL(blob);\n\n\treturn tempUrl;\n}\n\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\nexport function revokeBlobUrl(url){\n\treturn _URL.revokeObjectURL(url);\n}\n\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBase64Url(content, mime){\n\tvar data;\n\tvar datauri;\n\n\tif (typeof(content) !== \"string\") {\n\t\t// Only handles strings\n\t\treturn;\n\t}\n\n\tdata = btoa(content);\n\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\n\n\treturn datauri;\n}\n\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\nexport function type(obj){\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\n}\n\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\nexport function parse(markup, mime, forceXMLDom) {\n\tvar doc;\n\tvar Parser;\n\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\n\t\tParser = XMLDOMParser;\n\t} else {\n\t\tParser = DOMParser;\n\t}\n\n\t// Remove byte order mark before parsing\n\t// https://www.w3.org/International/questions/qa-byte-order-mark\n\tif(markup.charCodeAt(0) === 0xFEFF) {\n\t\tmarkup = markup.slice(1);\n\t}\n\n\tdoc = new Parser().parseFromString(markup, mime);\n\n\treturn doc;\n}\n\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\nexport function qs(el, sel) {\n\tvar elements;\n\tif (!el) {\n\t\tthrow new Error(\"No Element Provided\");\n\t}\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\telements = el.getElementsByTagName(sel);\n\t\tif (elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\t}\n}\n\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsa(el, sel) {\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelectorAll(sel);\n\t} else {\n\t\treturn el.getElementsByTagName(sel);\n\t}\n}\n\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsp(el, sel, props) {\n\tvar q, filtered;\n\tif (typeof el.querySelector != \"undefined\") {\n\t\tsel += \"[\";\n\t\tfor (var prop in props) {\n\t\t\tsel += prop + \"~='\" + props[prop] + \"'\";\n\t\t}\n\t\tsel += \"]\";\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\tq = el.getElementsByTagName(sel);\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\n\t\t\tfor (var prop in props) {\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (filtered) {\n\t\t\treturn filtered[0];\n\t\t}\n\t}\n}\n\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n\tvar doc = root.ownerDocument || root;\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\n\t} else {\n\t\twalk(root, function(node) {\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\n\t\t\t\tfunc(node);\n\t\t\t}\n\t\t}, true);\n\t}\n}\n\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter function or object to filter with\n */\nexport function treeWalker(root, func, filter) {\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\n\tlet node;\n\twhile ((node = treeWalker.nextNode())) {\n\t\tfunc(node);\n\t}\n}\n\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\nexport function walk(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tnode = node.firstChild;\n\tif(node){\n\t\tdo{\n\t\t\tlet walked = walk(node,callback);\n\t\t\tif(walked){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tnode = node.nextSibling;\n\t\t} while(node);\n\t}\n}\n\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\nexport function blob2base64(blob) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar reader = new FileReader();\n\t\treader.readAsDataURL(blob);\n\t\treader.onloadend = function() {\n\t\t\tresolve(reader.result);\n\t\t};\n\t});\n}\n\n\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\nexport function defer() {\n\t/* A method to resolve the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} value : This value is used to resolve the promise\n\t * If the value is a Promise then the associated promise assumes the state\n\t * of Promise passed as value.\n\t */\n\tthis.resolve = null;\n\n\t/* A method to reject the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} reason: The reason for the rejection of the Promise.\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\n\t * itself will be the reason for rejection no matter the state of the Promise.\n\t */\n\tthis.reject = null;\n\n\tthis.id = uuid();\n\n\t/* A newly created Pomise object.\n\t * Initially in pending state.\n\t */\n\tthis.promise = new Promise((resolve, reject) => {\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t});\n\tObject.freeze(this);\n}\n\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function querySelectorByType(html, element, type){\n\tvar query;\n\tif (typeof html.querySelector != \"undefined\") {\n\t\tquery = html.querySelector(`${element}[*|type=\"${type}\"]`);\n\t}\n\t// Handle IE not supporting namespaced epub:type in querySelector\n\tif(!query || query.length === 0) {\n\t\tquery = qsa(html, element);\n\t\tfor (var i = 0; i < query.length; i++) {\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type ||\n\t\t\t\t query[i].getAttribute(\"epub:type\") === type) {\n\t\t\t\treturn query[i];\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn query;\n\t}\n}\n\n/**\n * Find direct descendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\nexport function findChildren(el) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function parents(node) {\n\tvar nodes = [node];\n\tfor (; node; node = node.parentNode) {\n\t\tnodes.unshift(node);\n\t}\n\treturn nodes\n}\n\n/**\n * Find all direct descendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\nexport function filterChildren(el, nodeName, single) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n\t\t\tif (single) {\n\t\t\t\treturn node;\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t}\n\t}\n\tif (!single) {\n\t\treturn result;\n\t}\n}\n\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function getParentByTagName(node, tagname) {\n\tlet parent;\n\tif (node === null || tagname === '') return;\n\tparent = node.parentNode;\n\twhile (parent.nodeType === 1) {\n\t\tif (parent.tagName.toLowerCase() === tagname) {\n\t\t\treturn parent;\n\t\t}\n\t\tparent = parent.parentNode;\n\t}\n}\n\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\nexport class RangeObject {\n\tconstructor() {\n\t\tthis.collapsed = false;\n\t\tthis.commonAncestorContainer = undefined;\n\t\tthis.endContainer = undefined;\n\t\tthis.endOffset = undefined;\n\t\tthis.startContainer = undefined;\n\t\tthis.startOffset = undefined;\n\t}\n\n\tsetStart(startNode, startOffset) {\n\t\tthis.startContainer = startNode;\n\t\tthis.startOffset = startOffset;\n\n\t\tif (!this.endContainer) {\n\t\t\tthis.collapse(true);\n\t\t} else {\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tsetEnd(endNode, endOffset) {\n\t\tthis.endContainer = endNode;\n\t\tthis.endOffset = endOffset;\n\n\t\tif (!this.startContainer) {\n\t\t\tthis.collapse(false);\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tcollapse(toStart) {\n\t\tthis.collapsed = true;\n\t\tif (toStart) {\n\t\t\tthis.endContainer = this.startContainer;\n\t\t\tthis.endOffset = this.startOffset;\n\t\t\tthis.commonAncestorContainer = this.startContainer.parentNode;\n\t\t} else {\n\t\t\tthis.startContainer = this.endContainer;\n\t\t\tthis.startOffset = this.endOffset;\n\t\t\tthis.commonAncestorContainer = this.endOffset.parentNode;\n\t\t}\n\t}\n\n\tselectNode(referenceNode) {\n\t\tlet parent = referenceNode.parentNode;\n\t\tlet index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n\t\tthis.setStart(parent, index);\n\t\tthis.setEnd(parent, index + 1);\n\t}\n\n\tselectNodeContents(referenceNode) {\n\t\tlet end = referenceNode.childNodes[referenceNode.childNodes - 1];\n\t\tlet endIndex = (referenceNode.nodeType === 3) ?\n\t\t\t\treferenceNode.textContent.length : parent.childNodes.length;\n\t\tthis.setStart(referenceNode, 0);\n\t\tthis.setEnd(referenceNode, endIndex);\n\t}\n\n\t_commonAncestorContainer(startContainer, endContainer) {\n\t\tvar startParents = parents(startContainer || this.startContainer);\n\t\tvar endParents = parents(endContainer || this.endContainer);\n\n\t\tif (startParents[0] != endParents[0]) return undefined;\n\n\t\tfor (var i = 0; i < startParents.length; i++) {\n\t\t\tif (startParents[i] != endParents[i]) {\n\t\t\t\treturn startParents[i - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\t_checkCollapsed() {\n\t\tif (this.startContainer === this.endContainer &&\n\t\t\t\tthis.startOffset === this.endOffset) {\n\t\t\tthis.collapsed = true;\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t}\n\t}\n\n\ttoString() {\n\t\t// TODO: implement walking between start and end to find text\n\t}\n}\n"],"names":["requestAnimationFrame","ELEMENT_NODE","TEXT_NODE","_URL","uuid","d","c","documentHeight","isElement","obj","isNumber","n","isFloat","f","prefixed","unprefixed","vendors","prefixes","lower","length","i","defaults","source","prop","extend","target","sources","propName","insert","item","array","compareFunction","location","locationOf","_start","_end","start","end","pivot","compared","a","b","indexOfSorted","bounds","el","style","widthProps","heightProps","width","height","borders","nodeBounds","node","elPos","doc","elRange","windowBounds","indexOfNode","typeId","parent","children","sib","index","indexOfTextNode","textNode","indexOfElementNode","elementNode","isXml","ext","createBlob","content","mime","createBlobUrl","tempUrl","blob","revokeBlobUrl","url","createBase64Url","data","datauri","type","parse","markup","forceXMLDom","Parser","XMLDOMParser","qs","sel","elements","qsa","qsp","props","q","filtered","sprint","root","func","treeWalker","walk","filter","callback","blob2base64","resolve","reject","reader","defer","querySelectorByType","html","element","query","findChildren","result","childNodes","parents","nodes","filterChildren","nodeName","single","getParentByTagName","tagname","RangeObject","startNode","startOffset","endNode","endOffset","toStart","referenceNode","endIndex","startContainer","endContainer","startParents","endParents"],"mappings":"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","x_google_ignoreList":[0]}