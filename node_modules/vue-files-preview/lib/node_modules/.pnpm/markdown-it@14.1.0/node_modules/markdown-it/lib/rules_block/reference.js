"use strict";const h=require("../common/utils.js");function E(n,s,w,y){let e=n.bMarks[s]+n.tShift[s],i=n.eMarks[s],f=s+1;if(n.sCount[s]-n.blkIndent>=4||n.src.charCodeAt(e)!==91)return!1;function t(r){const o=n.lineMax;if(r>=o||n.isEmpty(r))return null;let k=!1;if(n.sCount[r]-n.blkIndent>3&&(k=!0),n.sCount[r]<0&&(k=!0),!k){const x=n.md.block.ruler.getRules("reference"),M=n.parentType;n.parentType="reference";let g=!1;for(let C=0,R=x.length;C<R;C++)if(x[C](n,r,o,!0)){g=!0;break}if(n.parentType=M,g)return null}const T=n.bMarks[r]+n.tShift[r],v=n.eMarks[r];return n.src.slice(T,v+1)}let l=n.src.slice(e,i+1);i=l.length;let u=-1;for(e=1;e<i;e++){const r=l.charCodeAt(e);if(r===91)return!1;if(r===93){u=e;break}else if(r===10){const o=t(f);o!==null&&(l+=o,i=l.length,f++)}else if(r===92&&(e++,e<i&&l.charCodeAt(e)===10)){const o=t(f);o!==null&&(l+=o,i=l.length,f++)}}if(u<0||l.charCodeAt(u+1)!==58)return!1;for(e=u+2;e<i;e++){const r=l.charCodeAt(e);if(r===10){const o=t(f);o!==null&&(l+=o,i=l.length,f++)}else if(!h.isSpace(r))break}const p=n.md.helpers.parseLinkDestination(l,e,i);if(!p.ok)return!1;const A=n.md.normalizeLink(p.str);if(!n.md.validateLink(A))return!1;e=p.pos;const b=e,m=f,S=e;for(;e<i;e++){const r=l.charCodeAt(e);if(r===10){const o=t(f);o!==null&&(l+=o,i=l.length,f++)}else if(!h.isSpace(r))break}let c=n.md.helpers.parseLinkTitle(l,e,i);for(;c.can_continue;){const r=t(f);if(r===null)break;l+=r,e=i,i=l.length,f++,c=n.md.helpers.parseLinkTitle(l,e,i,c)}let d;for(e<i&&S!==e&&c.ok?(d=c.str,e=c.pos):(d="",e=b,f=m);e<i;){const r=l.charCodeAt(e);if(!h.isSpace(r))break;e++}if(e<i&&l.charCodeAt(e)!==10&&d)for(d="",e=b,f=m;e<i;){const r=l.charCodeAt(e);if(!h.isSpace(r))break;e++}if(e<i&&l.charCodeAt(e)!==10)return!1;const a=h.normalizeReference(l.slice(1,u));return a?(y||(typeof n.env.references>"u"&&(n.env.references={}),typeof n.env.references[a]>"u"&&(n.env.references[a]={title:d,href:A}),n.line=f),!0):!1}module.exports=E;
//# sourceMappingURL=reference.js.map
