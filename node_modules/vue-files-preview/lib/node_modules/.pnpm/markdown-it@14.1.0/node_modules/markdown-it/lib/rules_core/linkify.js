"use strict";const _=require("../common/utils.js");function w(e){return/^<a[>\s]/i.test(e)}function g(e){return/^<\/a\s*>/i.test(e)}function z(e){const r=e.tokens;if(e.md.options.linkify)for(let s=0,T=r.length;s<T;s++){if(r[s].type!=="inline"||!e.md.linkify.pretest(r[s].content))continue;let c=r[s].children,m=0;for(let l=c.length-1;l>=0;l--){const i=c[l];if(i.type==="link_close"){for(l--;c[l].level!==i.level&&c[l].type!=="link_open";)l--;continue}if(i.type==="html_inline"&&(w(i.content)&&m>0&&m--,g(i.content)&&m++),!(m>0)&&i.type==="text"&&e.md.linkify.test(i.content)){const h=i.content;let t=e.md.linkify.match(h);const k=[];let f=i.level,u=0;t.length>0&&t[0].index===0&&l>0&&c[l-1].type==="text_special"&&(t=t.slice(1));for(let n=0;n<t.length;n++){const L=t[n].url,y=e.md.normalizeLink(L);if(!e.md.validateLink(y))continue;let o=t[n].text;t[n].schema?t[n].schema==="mailto:"&&!/^mailto:/i.test(o)?o=e.md.normalizeLinkText("mailto:"+o).replace(/^mailto:/,""):o=e.md.normalizeLinkText(o):o=e.md.normalizeLinkText("http://"+o).replace(/^http:\/\//,"");const v=t[n].index;if(v>u){const x=new e.Token("text","",0);x.content=h.slice(u,v),x.level=f,k.push(x)}const p=new e.Token("link_open","a",1);p.attrs=[["href",y]],p.level=f++,p.markup="linkify",p.info="auto",k.push(p);const d=new e.Token("text","",0);d.content=o,d.level=f,k.push(d);const a=new e.Token("link_close","a",-1);a.level=--f,a.markup="linkify",a.info="auto",k.push(a),u=t[n].lastIndex}if(u<h.length){const n=new e.Token("text","",0);n.content=h.slice(u),n.level=f,k.push(n)}r[s].children=c=_.arrayReplaceAt(c,l,k)}}}}module.exports=z;
//# sourceMappingURL=linkify.js.map
