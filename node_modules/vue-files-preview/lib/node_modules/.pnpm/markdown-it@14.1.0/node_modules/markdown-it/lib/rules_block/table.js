"use strict";const g=require("../common/utils.js"),I=65536;function x(e,o){const p=e.bMarks[o]+e.tShift[o],i=e.eMarks[o];return e.src.slice(p,i)}function y(e){const o=[],p=e.length;let i=0,l=e.charCodeAt(i),c=!1,h=0,u="";for(;i<p;)l===124&&(c?(u+=e.substring(h,i-1),h=i):(o.push(u+e.substring(h,i)),u="",h=i+1)),c=l===92,i++,l=e.charCodeAt(i);return o.push(u+e.substring(h)),o}function E(e,o,p,i){if(o+2>p)return!1;let l=o+1;if(e.sCount[l]<e.blkIndent||e.sCount[l]-e.blkIndent>=4)return!1;let c=e.bMarks[l]+e.tShift[l];if(c>=e.eMarks[l])return!1;const h=e.src.charCodeAt(c++);if(h!==124&&h!==45&&h!==58||c>=e.eMarks[l])return!1;const u=e.src.charCodeAt(c++);if(u!==124&&u!==45&&u!==58&&!g.isSpace(u)||h===45&&g.isSpace(u))return!1;for(;c<e.eMarks[l];){const r=e.src.charCodeAt(c);if(r!==124&&r!==45&&r!==58&&!g.isSpace(r))return!1;c++}let d=x(e,o+1),n=d.split("|");const s=[];for(let r=0;r<n.length;r++){const f=n[r].trim();if(!f){if(r===0||r===n.length-1)continue;return!1}if(!/^:?-+:?$/.test(f))return!1;f.charCodeAt(f.length-1)===58?s.push(f.charCodeAt(0)===58?"center":"right"):f.charCodeAt(0)===58?s.push("left"):s.push("")}if(d=x(e,o).trim(),d.indexOf("|")===-1||e.sCount[o]-e.blkIndent>=4)return!1;n=y(d),n.length&&n[0]===""&&n.shift(),n.length&&n[n.length-1]===""&&n.pop();const b=n.length;if(b===0||b!==s.length)return!1;if(i)return!0;const M=e.parentType;e.parentType="table";const C=e.md.block.ruler.getRules("blockquote"),S=e.push("table_open","table",1),m=[o,0];S.map=m;const T=e.push("thead_open","thead",1);T.map=[o,o+1];const D=e.push("tr_open","tr",1);D.map=[o,o+1];for(let r=0;r<n.length;r++){const f=e.push("th_open","th",1);s[r]&&(f.attrs=[["style","text-align:"+s[r]]]);const t=e.push("inline","",0);t.content=n[r].trim(),t.children=[],e.push("th_close","th",-1)}e.push("tr_close","tr",-1),e.push("thead_close","thead",-1);let k,A=0;for(l=o+2;l<p&&!(e.sCount[l]<e.blkIndent);l++){let r=!1;for(let t=0,_=C.length;t<_;t++)if(C[t](e,l,p,!0)){r=!0;break}if(r||(d=x(e,l).trim(),!d)||e.sCount[l]-e.blkIndent>=4||(n=y(d),n.length&&n[0]===""&&n.shift(),n.length&&n[n.length-1]===""&&n.pop(),A+=b-n.length,A>I))break;if(l===o+2){const t=e.push("tbody_open","tbody",1);t.map=k=[o+2,0]}const f=e.push("tr_open","tr",1);f.map=[l,l+1];for(let t=0;t<b;t++){const _=e.push("td_open","td",1);s[t]&&(_.attrs=[["style","text-align:"+s[t]]]);const a=e.push("inline","",0);a.content=n[t]?n[t].trim():"",a.children=[],e.push("td_close","td",-1)}e.push("tr_close","tr",-1)}return k&&(e.push("tbody_close","tbody",-1),k[1]=l),e.push("table_close","table",-1),m[1]=l,e.parentType=M,e.line=l,!0}module.exports=E;
//# sourceMappingURL=table.js.map
