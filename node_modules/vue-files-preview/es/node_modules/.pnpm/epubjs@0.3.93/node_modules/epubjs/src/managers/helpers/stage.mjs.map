{"version":3,"file":"stage.mjs","sources":["../../../../../../../../../../node_modules/.pnpm/epubjs@0.3.93/node_modules/epubjs/src/managers/helpers/stage.js"],"sourcesContent":["import {uuid, isNumber, isElement, windowBounds, extend} from \"../../utils/core\";\nimport throttle from 'lodash/throttle'\n\nclass Stage {\n\tconstructor(_options) {\n\t\tthis.settings = _options || {};\n\t\tthis.id = \"epubjs-container-\" + uuid();\n\n\t\tthis.container = this.create(this.settings);\n\n\t\tif(this.settings.hidden) {\n\t\t\tthis.wrapper = this.wrap(this.container);\n\t\t}\n\n\t}\n\n\t/*\n\t* Creates an element to render to.\n\t* Resizes to passed width and height or to the elements size\n\t*/\n\tcreate(options){\n\t\tlet height  = options.height;// !== false ? options.height : \"100%\";\n\t\tlet width   = options.width;// !== false ? options.width : \"100%\";\n\t\tlet overflow  = options.overflow || false;\n\t\tlet axis = options.axis || \"vertical\";\n\t\tlet direction = options.direction;\n\n\t\textend(this.settings, options);\n\n\t\tif(options.height && isNumber(options.height)) {\n\t\t\theight = options.height + \"px\";\n\t\t}\n\n\t\tif(options.width && isNumber(options.width)) {\n\t\t\twidth = options.width + \"px\";\n\t\t}\n\n\t\t// Create new container element\n\t\tlet container = document.createElement(\"div\");\n\n\t\tcontainer.id = this.id;\n\t\tcontainer.classList.add(\"epub-container\");\n\n\t\t// Style Element\n\t\t// container.style.fontSize = \"0\";\n\t\tcontainer.style.wordSpacing = \"0\";\n\t\tcontainer.style.lineHeight = \"0\";\n\t\tcontainer.style.verticalAlign = \"top\";\n\t\tcontainer.style.position = \"relative\";\n\n\t\tif(axis === \"horizontal\") {\n\t\t\t// container.style.whiteSpace = \"nowrap\";\n\t\t\tcontainer.style.display = \"flex\";\n\t\t\tcontainer.style.flexDirection = \"row\";\n\t\t\tcontainer.style.flexWrap = \"nowrap\";\n\t\t}\n\n\t\tif(width){\n\t\t\tcontainer.style.width = width;\n\t\t}\n\n\t\tif(height){\n\t\t\tcontainer.style.height = height;\n\t\t}\n\n\t\tif (overflow) {\n\t\t\tif (overflow === \"scroll\" && axis === \"vertical\") {\n\t\t\t\tcontainer.style[\"overflow-y\"] = overflow;\n\t\t\t\tcontainer.style[\"overflow-x\"] = \"hidden\";\n\t\t\t} else if (overflow === \"scroll\" && axis === \"horizontal\") {\n\t\t\t\tcontainer.style[\"overflow-y\"] = \"hidden\";\n\t\t\t\tcontainer.style[\"overflow-x\"] = overflow;\n\t\t\t} else {\n\t\t\t\tcontainer.style[\"overflow\"] = overflow;\n\t\t\t}\n\t\t}\n\n\t\tif (direction) {\n\t\t\tcontainer.dir = direction;\n\t\t\tcontainer.style[\"direction\"] = direction;\n\t\t}\n\n\t\tif (direction && this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = direction;\n\t\t}\n\n\t\treturn container;\n\t}\n\n\twrap(container) {\n\t\tvar wrapper = document.createElement(\"div\");\n\n\t\twrapper.style.visibility = \"hidden\";\n\t\twrapper.style.overflow = \"hidden\";\n\t\twrapper.style.width = \"0\";\n\t\twrapper.style.height = \"0\";\n\n\t\twrapper.appendChild(container);\n\t\treturn wrapper;\n\t}\n\n\n\tgetElement(_element){\n\t\tvar element;\n\n\t\tif(isElement(_element)) {\n\t\t\telement = _element;\n\t\t} else if (typeof _element === \"string\") {\n\t\t\telement = document.getElementById(_element);\n\t\t}\n\n\t\tif(!element){\n\t\t\tthrow new Error(\"Not an Element\");\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tattachTo(what){\n\n\t\tvar element = this.getElement(what);\n\t\tvar base;\n\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.settings.hidden) {\n\t\t\tbase = this.wrapper;\n\t\t} else {\n\t\t\tbase = this.container;\n\t\t}\n\n\t\telement.appendChild(base);\n\n\t\tthis.element = element;\n\n\t\treturn element;\n\n\t}\n\n\tgetContainer() {\n\t\treturn this.container;\n\t}\n\n\tonResize(func){\n\t\t// Only listen to window for resize event if width and height are not fixed.\n\t\t// This applies if it is set to a percent or auto.\n\t\tif(!isNumber(this.settings.width) ||\n\t\t\t !isNumber(this.settings.height) ) {\n\t\t\tthis.resizeFunc = throttle(func, 50);\n\t\t\twindow.addEventListener(\"resize\", this.resizeFunc, false);\n\t\t}\n\n\t}\n\n\tonOrientationChange(func){\n\t\tthis.orientationChangeFunc = func;\n\t\twindow.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\n\t}\n\n\tsize(width, height){\n\t\tvar bounds;\n\t\tlet _width = width || this.settings.width;\n\t\tlet _height = height || this.settings.height;\n\n\t\t// If width or height are set to false, inherit them from containing element\n\t\tif(width === null) {\n\t\t\tbounds = this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.width) {\n\t\t\t\twidth = Math.floor(bounds.width);\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (isNumber(width)) {\n\t\t\t\tthis.container.style.width = width + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.width = width;\n\t\t\t}\n\t\t}\n\n\t\tif(height === null) {\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\n\n\t\t\tif(bounds.height) {\n\t\t\t\theight = bounds.height;\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (isNumber(height)) {\n\t\t\t\tthis.container.style.height = height + \"px\";\n\t\t\t} else {\n\t\t\t\tthis.container.style.height = height;\n\t\t\t}\n\t\t}\n\n\t\tif(!isNumber(width)) {\n\t\t\twidth = this.container.clientWidth;\n\t\t}\n\n\t\tif(!isNumber(height)) {\n\t\t\theight = this.container.clientHeight;\n\t\t}\n\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\n\n\t\tthis.containerPadding = {\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\t// Bounds not set, get them from window\n\t\tlet _windowBounds = windowBounds();\n\t\tlet bodyStyles = window.getComputedStyle(document.body);\n\t\tlet bodyPadding = {\n\t\t\tleft: parseFloat(bodyStyles[\"padding-left\"]) || 0,\n\t\t\tright: parseFloat(bodyStyles[\"padding-right\"]) || 0,\n\t\t\ttop: parseFloat(bodyStyles[\"padding-top\"]) || 0,\n\t\t\tbottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\n\t\t};\n\n\t\tif (!_width) {\n\t\t\twidth = _windowBounds.width -\n\t\t\t\t\t\t\t\tbodyPadding.left -\n\t\t\t\t\t\t\t\tbodyPadding.right;\n\t\t}\n\n\t\tif ((this.settings.fullsize && !_height) || !_height) {\n\t\t\theight = _windowBounds.height -\n\t\t\t\t\t\t\t\tbodyPadding.top -\n\t\t\t\t\t\t\t\tbodyPadding.bottom;\n\t\t}\n\n\t\treturn {\n\t\t\twidth: width -\n\t\t\t\t\t\t\tthis.containerPadding.left -\n\t\t\t\t\t\t\tthis.containerPadding.right,\n\t\t\theight: height -\n\t\t\t\t\t\t\tthis.containerPadding.top -\n\t\t\t\t\t\t\tthis.containerPadding.bottom\n\t\t};\n\n\t}\n\n\tbounds(){\n\t\tlet box;\n\t\tif (this.container.style.overflow !== \"visible\") {\n\t\t\tbox = this.container && this.container.getBoundingClientRect();\n\t\t}\n\n\t\tif(!box || !box.width || !box.height) {\n\t\t\treturn windowBounds();\n\t\t} else {\n\t\t\treturn box;\n\t\t}\n\n\t}\n\n\tgetSheet(){\n\t\tvar style = document.createElement(\"style\");\n\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\n\t\tstyle.appendChild(document.createTextNode(\"\"));\n\n\t\tdocument.head.appendChild(style);\n\n\t\treturn style.sheet;\n\t}\n\n\taddStyleRules(selector, rulesArray){\n\t\tvar scope = \"#\" + this.id + \" \";\n\t\tvar rules = \"\";\n\n\t\tif(!this.sheet){\n\t\t\tthis.sheet = this.getSheet();\n\t\t}\n\n\t\trulesArray.forEach(function(set) {\n\t\t\tfor (var prop in set) {\n\t\t\t\tif(set.hasOwnProperty(prop)) {\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\n\t}\n\n\taxis(axis) {\n\t\tif(axis === \"horizontal\") {\n\t\t\tthis.container.style.display = \"flex\";\n\t\t\tthis.container.style.flexDirection = \"row\";\n\t\t\tthis.container.style.flexWrap = \"nowrap\";\n\t\t} else {\n\t\t\tthis.container.style.display = \"block\";\n\t\t}\n\t\tthis.settings.axis = axis;\n\t}\n\n\t// orientation(orientation) {\n\t// \tif (orientation === \"landscape\") {\n\t//\n\t// \t} else {\n\t//\n\t// \t}\n\t//\n\t// \tthis.orientation = orientation;\n\t// }\n\n\tdirection(dir) {\n\t\tif (this.container) {\n\t\t\tthis.container.dir = dir;\n\t\t\tthis.container.style[\"direction\"] = dir;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tdocument.body.style[\"direction\"] = dir;\n\t\t}\n\t\tthis.settings.dir = dir;\n\t}\n\n\toverflow(overflow) {\n\t\tif (this.container) {\n\t\t\tif (overflow === \"scroll\" && this.settings.axis === \"vertical\") {\n\t\t\t\tthis.container.style[\"overflow-y\"] = overflow;\n\t\t\t\tthis.container.style[\"overflow-x\"] = \"hidden\";\n\t\t\t} else if (overflow === \"scroll\" && this.settings.axis === \"horizontal\") {\n\t\t\t\tthis.container.style[\"overflow-y\"] = \"hidden\";\n\t\t\t\tthis.container.style[\"overflow-x\"] = overflow;\n\t\t\t} else {\n\t\t\t\tthis.container.style[\"overflow\"] = overflow;\n\t\t\t}\n\t\t}\n\t\tthis.settings.overflow = overflow;\n\t}\n\n\tdestroy() {\n\t\tvar base;\n\n\t\tif (this.element) {\n\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tbase = this.wrapper;\n\t\t\t} else {\n\t\t\t\tbase = this.container;\n\t\t\t}\n\n\t\t\tif(this.element.contains(this.container)) {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\n\t\t\twindow.removeEventListener(\"resize\", this.resizeFunc);\n\t\t\twindow.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\n\n\t\t}\n\t}\n}\n\nexport default Stage;\n"],"names":["Stage","_options","uuid","options","height","width","overflow","axis","direction","extend","isNumber","container","wrapper","_element","element","isElement","what","base","func","throttle","bounds","_width","_height","_windowBounds","windowBounds","bodyStyles","bodyPadding","box","style","selector","rulesArray","scope","rules","set","prop","dir"],"mappings":"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","x_google_ignoreList":[0]}