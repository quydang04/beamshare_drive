{"version":3,"file":"dom.mjs","sources":["../../../../../../../../../node_modules/.pnpm/@xmldom+xmldom@0.7.13/node_modules/@xmldom/xmldom/lib/dom.js"],"sourcesContent":["var conventions = require(\"./conventions\");\n\nvar find = conventions.find;\nvar NAMESPACE = conventions.NAMESPACE;\n\n/**\n * A prerequisite for `[].filter`, to drop elements that are empty\n * @param {string} input\n * @returns {boolean}\n */\nfunction notEmptyString (input) {\n\treturn input !== ''\n}\n/**\n * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace\n * @see https://infra.spec.whatwg.org/#ascii-whitespace\n *\n * @param {string} input\n * @returns {string[]} (can be empty)\n */\nfunction splitOnASCIIWhitespace(input) {\n\t// U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE\n\treturn input ? input.split(/[\\t\\n\\f\\r ]+/).filter(notEmptyString) : []\n}\n\n/**\n * Adds element as a key to current if it is not already present.\n *\n * @param {Record<string, boolean | undefined>} current\n * @param {string} element\n * @returns {Record<string, boolean | undefined>}\n */\nfunction orderedSetReducer (current, element) {\n\tif (!current.hasOwnProperty(element)) {\n\t\tcurrent[element] = true;\n\t}\n\treturn current;\n}\n\n/**\n * @see https://infra.spec.whatwg.org/#ordered-set\n * @param {string} input\n * @returns {string[]}\n */\nfunction toOrderedSet(input) {\n\tif (!input) return [];\n\tvar list = splitOnASCIIWhitespace(input);\n\treturn Object.keys(list.reduce(orderedSetReducer, {}))\n}\n\n/**\n * Uses `list.indexOf` to implement something like `Array.prototype.includes`,\n * which we can not rely on being available.\n *\n * @param {any[]} list\n * @returns {function(any): boolean}\n */\nfunction arrayIncludes (list) {\n\treturn function(element) {\n\t\treturn list && list.indexOf(element) !== -1;\n\t}\n}\n\nfunction copy(src,dest){\n\tfor(var p in src){\n\t\tif (Object.prototype.hasOwnProperty.call(src, p)) {\n\t\t\tdest[p] = src[p];\n\t\t}\n\t}\n}\n\n/**\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\n */\nfunction _extends(Class,Super){\n\tvar pt = Class.prototype;\n\tif(!(pt instanceof Super)){\n\t\tfunction t(){};\n\t\tt.prototype = Super.prototype;\n\t\tt = new t();\n\t\tcopy(pt,t);\n\t\tClass.prototype = pt = t;\n\t}\n\tif(pt.constructor != Class){\n\t\tif(typeof Class != 'function'){\n\t\t\tconsole.error(\"unknown Class:\"+Class)\n\t\t}\n\t\tpt.constructor = Class\n\t}\n}\n\n// Node Types\nvar NodeType = {}\nvar ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;\nvar ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;\nvar TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;\nvar CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;\nvar ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;\nvar ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\nvar COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;\nvar DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;\nvar DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;\nvar DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;\nvar NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;\n\n// ExceptionCode\nvar ExceptionCode = {}\nvar ExceptionMessage = {};\nvar INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]=\"Index size error\"),1);\nvar DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]=\"DOMString size error\"),2);\nvar HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]=\"Hierarchy request error\"),3);\nvar WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]=\"Wrong document\"),4);\nvar INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]=\"Invalid character\"),5);\nvar NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]=\"No data allowed\"),6);\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]=\"No modification allowed\"),7);\nvar NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]=\"Not found\"),8);\nvar NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]=\"Not supported\"),9);\nvar INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]=\"Attribute in use\"),10);\n//level2\nvar INVALID_STATE_ERR        \t= ExceptionCode.INVALID_STATE_ERR        \t= ((ExceptionMessage[11]=\"Invalid state\"),11);\nvar SYNTAX_ERR               \t= ExceptionCode.SYNTAX_ERR               \t= ((ExceptionMessage[12]=\"Syntax error\"),12);\nvar INVALID_MODIFICATION_ERR \t= ExceptionCode.INVALID_MODIFICATION_ERR \t= ((ExceptionMessage[13]=\"Invalid modification\"),13);\nvar NAMESPACE_ERR            \t= ExceptionCode.NAMESPACE_ERR           \t= ((ExceptionMessage[14]=\"Invalid namespace\"),14);\nvar INVALID_ACCESS_ERR       \t= ExceptionCode.INVALID_ACCESS_ERR      \t= ((ExceptionMessage[15]=\"Invalid access\"),15);\n\n/**\n * DOM Level 2\n * Object DOMException\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\n */\nfunction DOMException(code, message) {\n\tif(message instanceof Error){\n\t\tvar error = message;\n\t}else{\n\t\terror = this;\n\t\tError.call(this, ExceptionMessage[code]);\n\t\tthis.message = ExceptionMessage[code];\n\t\tif(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\n\t}\n\terror.code = code;\n\tif(message) this.message = this.message + \": \" + message;\n\treturn error;\n};\nDOMException.prototype = Error.prototype;\ncopy(ExceptionCode,DOMException)\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\n * The items in the NodeList are accessible via an integral index, starting from 0.\n */\nfunction NodeList() {\n};\nNodeList.prototype = {\n\t/**\n\t * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\n\t * @standard level1\n\t */\n\tlength:0,\n\t/**\n\t * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\n\t * @standard level1\n\t * @param index  unsigned long\n\t *   Index into the collection.\n\t * @return Node\n\t * \tThe node at the indexth position in the NodeList, or null if that is not a valid index.\n\t */\n\titem: function(index) {\n\t\treturn index >= 0 && index < this.length ? this[index] : null;\n\t},\n\ttoString:function(isHTML,nodeFilter){\n\t\tfor(var buf = [], i = 0;i<this.length;i++){\n\t\t\tserializeToString(this[i],buf,isHTML,nodeFilter);\n\t\t}\n\t\treturn buf.join('');\n\t},\n\t/**\n\t * @private\n\t * @param {function (Node):boolean} predicate\n\t * @returns {Node[]}\n\t */\n\tfilter: function (predicate) {\n\t\treturn Array.prototype.filter.call(this, predicate);\n\t},\n\t/**\n\t * @private\n\t * @param {Node} item\n\t * @returns {number}\n\t */\n\tindexOf: function (item) {\n\t\treturn Array.prototype.indexOf.call(this, item);\n\t},\n};\n\nfunction LiveNodeList(node,refresh){\n\tthis._node = node;\n\tthis._refresh = refresh\n\t_updateLiveList(this);\n}\nfunction _updateLiveList(list){\n\tvar inc = list._node._inc || list._node.ownerDocument._inc;\n\tif (list._inc !== inc) {\n\t\tvar ls = list._refresh(list._node);\n\t\t__set__(list,'length',ls.length);\n\t\tif (!list.$$length || ls.length < list.$$length) {\n\t\t\tfor (var i = ls.length; i in list; i++) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(list, i)) {\n\t\t\t\t\tdelete list[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcopy(ls,list);\n\t\tlist._inc = inc;\n\t}\n}\nLiveNodeList.prototype.item = function(i){\n\t_updateLiveList(this);\n\treturn this[i] || null;\n}\n\n_extends(LiveNodeList,NodeList);\n\n/**\n * Objects implementing the NamedNodeMap interface are used\n * to represent collections of nodes that can be accessed by name.\n * Note that NamedNodeMap does not inherit from NodeList;\n * NamedNodeMaps are not maintained in any particular order.\n * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,\n * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,\n * and does not imply that the DOM specifies an order to these Nodes.\n * NamedNodeMap objects in the DOM are live.\n * used for attributes or DocumentType entities\n */\nfunction NamedNodeMap() {\n};\n\nfunction _findNodeIndex(list,node){\n\tvar i = list.length;\n\twhile(i--){\n\t\tif(list[i] === node){return i}\n\t}\n}\n\nfunction _addNamedNode(el,list,newAttr,oldAttr){\n\tif(oldAttr){\n\t\tlist[_findNodeIndex(list,oldAttr)] = newAttr;\n\t}else{\n\t\tlist[list.length++] = newAttr;\n\t}\n\tif(el){\n\t\tnewAttr.ownerElement = el;\n\t\tvar doc = el.ownerDocument;\n\t\tif(doc){\n\t\t\toldAttr && _onRemoveAttribute(doc,el,oldAttr);\n\t\t\t_onAddAttribute(doc,el,newAttr);\n\t\t}\n\t}\n}\nfunction _removeNamedNode(el,list,attr){\n\t//console.log('remove attr:'+attr)\n\tvar i = _findNodeIndex(list,attr);\n\tif(i>=0){\n\t\tvar lastIndex = list.length-1\n\t\twhile(i<lastIndex){\n\t\t\tlist[i] = list[++i]\n\t\t}\n\t\tlist.length = lastIndex;\n\t\tif(el){\n\t\t\tvar doc = el.ownerDocument;\n\t\t\tif(doc){\n\t\t\t\t_onRemoveAttribute(doc,el,attr);\n\t\t\t\tattr.ownerElement = null;\n\t\t\t}\n\t\t}\n\t}else{\n\t\tthrow new DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))\n\t}\n}\nNamedNodeMap.prototype = {\n\tlength:0,\n\titem:NodeList.prototype.item,\n\tgetNamedItem: function(key) {\n//\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\n//\t\t\treturn null;\n//\t\t}\n\t\t//console.log()\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar attr = this[i];\n\t\t\t//console.log(attr.nodeName,key)\n\t\t\tif(attr.nodeName == key){\n\t\t\t\treturn attr;\n\t\t\t}\n\t\t}\n\t},\n\tsetNamedItem: function(attr) {\n\t\tvar el = attr.ownerElement;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\tvar oldAttr = this.getNamedItem(attr.nodeName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\t/* returns Node */\n\tsetNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\n\t\tvar el = attr.ownerElement, oldAttr;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\toldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\n\t/* returns Node */\n\tremoveNamedItem: function(key) {\n\t\tvar attr = this.getNamedItem(key);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\n\n\t},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\n\n\t//for level2\n\tremoveNamedItemNS:function(namespaceURI,localName){\n\t\tvar attr = this.getNamedItemNS(namespaceURI,localName);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t},\n\tgetNamedItemNS: function(namespaceURI, localName) {\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar node = this[i];\n\t\t\tif(node.localName == localName && node.namespaceURI == namespaceURI){\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};\n\n/**\n * The DOMImplementation interface represents an object providing methods\n * which are not dependent on any particular document.\n * Such an object is returned by the `Document.implementation` property.\n *\n * __The individual methods describe the differences compared to the specs.__\n *\n * @constructor\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN\n * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)\n * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core\n * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core\n * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard\n */\nfunction DOMImplementation() {\n}\n\nDOMImplementation.prototype = {\n\t/**\n\t * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.\n\t * The different implementations fairly diverged in what kind of features were reported.\n\t * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.\n\t *\n\t * @deprecated It is deprecated and modern browsers return true in all cases.\n\t *\n\t * @param {string} feature\n\t * @param {string} [version]\n\t * @returns {boolean} always true\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN\n\t * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard\n\t */\n\thasFeature: function(feature, version) {\n\t\t\treturn true;\n\t},\n\t/**\n\t * Creates an XML Document object of the specified type with its document element.\n\t *\n\t * __It behaves slightly different from the description in the living standard__:\n\t * - There is no interface/class `XMLDocument`, it returns a `Document` instance.\n\t * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.\n\t * - this implementation is not validating names or qualified names\n\t *   (when parsing XML strings, the SAX parser takes care of that)\n\t *\n\t * @param {string|null} namespaceURI\n\t * @param {string} qualifiedName\n\t * @param {DocumentType=null} doctype\n\t * @returns {Document}\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN\n\t * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core\n\t *\n\t * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\n\t * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\n\t * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\n\t */\n\tcreateDocument: function(namespaceURI,  qualifiedName, doctype){\n\t\tvar doc = new Document();\n\t\tdoc.implementation = this;\n\t\tdoc.childNodes = new NodeList();\n\t\tdoc.doctype = doctype || null;\n\t\tif (doctype){\n\t\t\tdoc.appendChild(doctype);\n\t\t}\n\t\tif (qualifiedName){\n\t\t\tvar root = doc.createElementNS(namespaceURI, qualifiedName);\n\t\t\tdoc.appendChild(root);\n\t\t}\n\t\treturn doc;\n\t},\n\t/**\n\t * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.\n\t *\n\t * __This behavior is slightly different from the in the specs__:\n\t * - this implementation is not validating names or qualified names\n\t *   (when parsing XML strings, the SAX parser takes care of that)\n\t *\n\t * @param {string} qualifiedName\n\t * @param {string} [publicId]\n\t * @param {string} [systemId]\n\t * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation\n\t * \t\t\t\t  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN\n\t * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core\n\t * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard\n\t *\n\t * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract\n\t * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names\n\t * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names\n\t */\n\tcreateDocumentType: function(qualifiedName, publicId, systemId){\n\t\tvar node = new DocumentType();\n\t\tnode.name = qualifiedName;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.publicId = publicId || '';\n\t\tnode.systemId = systemId || '';\n\n\t\treturn node;\n\t}\n};\n\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\n */\n\nfunction Node() {\n};\n\nNode.prototype = {\n\tfirstChild : null,\n\tlastChild : null,\n\tpreviousSibling : null,\n\tnextSibling : null,\n\tattributes : null,\n\tparentNode : null,\n\tchildNodes : null,\n\townerDocument : null,\n\tnodeValue : null,\n\tnamespaceURI : null,\n\tprefix : null,\n\tlocalName : null,\n\t// Modified in DOM Level 2:\n\tinsertBefore:function(newChild, refChild){//raises\n\t\treturn _insertBefore(this,newChild,refChild);\n\t},\n\treplaceChild:function(newChild, oldChild){//raises\n\t\t_insertBefore(this, newChild,oldChild, assertPreReplacementValidityInDocument);\n\t\tif(oldChild){\n\t\t\tthis.removeChild(oldChild);\n\t\t}\n\t},\n\tremoveChild:function(oldChild){\n\t\treturn _removeChild(this,oldChild);\n\t},\n\tappendChild:function(newChild){\n\t\treturn this.insertBefore(newChild,null);\n\t},\n\thasChildNodes:function(){\n\t\treturn this.firstChild != null;\n\t},\n\tcloneNode:function(deep){\n\t\treturn cloneNode(this.ownerDocument||this,this,deep);\n\t},\n\t// Modified in DOM Level 2:\n\tnormalize:function(){\n\t\tvar child = this.firstChild;\n\t\twhile(child){\n\t\t\tvar next = child.nextSibling;\n\t\t\tif(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){\n\t\t\t\tthis.removeChild(next);\n\t\t\t\tchild.appendData(next.data);\n\t\t\t}else{\n\t\t\t\tchild.normalize();\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t}\n\t},\n  \t// Introduced in DOM Level 2:\n\tisSupported:function(feature, version){\n\t\treturn this.ownerDocument.implementation.hasFeature(feature,version);\n\t},\n    // Introduced in DOM Level 2:\n    hasAttributes:function(){\n    \treturn this.attributes.length>0;\n    },\n\t/**\n\t * Look up the prefix associated to the given namespace URI, starting from this node.\n\t * **The default namespace declarations are ignored by this method.**\n\t * See Namespace Prefix Lookup for details on the algorithm used by this method.\n\t *\n\t * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._\n\t *\n\t * @param {string | null} namespaceURI\n\t * @returns {string | null}\n\t * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix\n\t * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo\n\t * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix\n\t * @see https://github.com/xmldom/xmldom/issues/322\n\t */\n    lookupPrefix:function(namespaceURI){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tfor(var n in map){\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(map, n) && map[n] === namespaceURI) {\n\t\t\t\t\t\treturn n;\n\t\t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    lookupNamespaceURI:function(prefix){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tif(prefix in map){\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(map, prefix)){\n\t\t\t\t\t\treturn map[prefix] ;\n\t\t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    isDefaultNamespace:function(namespaceURI){\n    \tvar prefix = this.lookupPrefix(namespaceURI);\n    \treturn prefix == null;\n    }\n};\n\n\nfunction _xmlEncoder(c){\n\treturn c == '<' && '&lt;' ||\n         c == '>' && '&gt;' ||\n         c == '&' && '&amp;' ||\n         c == '\"' && '&quot;' ||\n         '&#'+c.charCodeAt()+';'\n}\n\n\ncopy(NodeType,Node);\ncopy(NodeType,Node.prototype);\n\n/**\n * @param callback return true for continue,false for break\n * @return boolean true: break visit;\n */\nfunction _visitNode(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tif(node = node.firstChild){\n\t\tdo{\n\t\t\tif(_visitNode(node,callback)){return true}\n        }while(node=node.nextSibling)\n    }\n}\n\n\n\nfunction Document(){\n\tthis.ownerDocument = this;\n}\n\nfunction _onAddAttribute(doc,el,newAttr){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns === NAMESPACE.XMLNS){\n\t\t//update namespace\n\t\tel._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value\n\t}\n}\n\nfunction _onRemoveAttribute(doc,el,newAttr,remove){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns === NAMESPACE.XMLNS){\n\t\t//update namespace\n\t\tdelete el._nsMap[newAttr.prefix?newAttr.localName:'']\n\t}\n}\n\nfunction _onUpdateChild(doc,el,newChild){\n\tif(doc && doc._inc){\n\t\tdoc._inc++;\n\t\t//update childNodes\n\t\tvar cs = el.childNodes;\n\t\tif(newChild){\n\t\t\tcs[cs.length++] = newChild;\n\t\t}else{\n\t\t\t//console.log(1)\n\t\t\tvar child = el.firstChild;\n\t\t\tvar i = 0;\n\t\t\twhile(child){\n\t\t\t\tcs[i++] = child;\n\t\t\t\tchild =child.nextSibling;\n\t\t\t}\n\t\t\tcs.length = i;\n\t\t\tdelete cs[cs.length];\n\t\t}\n\t}\n}\n\n/**\n * attributes;\n * children;\n *\n * writeable properties:\n * nodeValue,Attr:value,CharacterData:data\n * prefix\n */\nfunction _removeChild(parentNode,child){\n\tvar previous = child.previousSibling;\n\tvar next = child.nextSibling;\n\tif(previous){\n\t\tprevious.nextSibling = next;\n\t}else{\n\t\tparentNode.firstChild = next\n\t}\n\tif(next){\n\t\tnext.previousSibling = previous;\n\t}else{\n\t\tparentNode.lastChild = previous;\n\t}\n\tchild.parentNode = null;\n\tchild.previousSibling = null;\n\tchild.nextSibling = null;\n\t_onUpdateChild(parentNode.ownerDocument,parentNode);\n\treturn child;\n}\n\n/**\n * Returns `true` if `node` can be a parent for insertion.\n * @param {Node} node\n * @returns {boolean}\n */\nfunction hasValidParentNodeType(node) {\n\treturn (\n\t\tnode &&\n\t\t(node.nodeType === Node.DOCUMENT_NODE || node.nodeType === Node.DOCUMENT_FRAGMENT_NODE || node.nodeType === Node.ELEMENT_NODE)\n\t);\n}\n\n/**\n * Returns `true` if `node` can be inserted according to it's `nodeType`.\n * @param {Node} node\n * @returns {boolean}\n */\nfunction hasInsertableNodeType(node) {\n\treturn (\n\t\tnode &&\n\t\t(isElementNode(node) ||\n\t\t\tisTextNode(node) ||\n\t\t\tisDocTypeNode(node) ||\n\t\t\tnode.nodeType === Node.DOCUMENT_FRAGMENT_NODE ||\n\t\t\tnode.nodeType === Node.COMMENT_NODE ||\n\t\t\tnode.nodeType === Node.PROCESSING_INSTRUCTION_NODE)\n\t);\n}\n\n/**\n * Returns true if `node` is a DOCTYPE node\n * @param {Node} node\n * @returns {boolean}\n */\nfunction isDocTypeNode(node) {\n\treturn node && node.nodeType === Node.DOCUMENT_TYPE_NODE;\n}\n\n/**\n * Returns true if the node is an element\n * @param {Node} node\n * @returns {boolean}\n */\nfunction isElementNode(node) {\n\treturn node && node.nodeType === Node.ELEMENT_NODE;\n}\n/**\n * Returns true if `node` is a text node\n * @param {Node} node\n * @returns {boolean}\n */\nfunction isTextNode(node) {\n\treturn node && node.nodeType === Node.TEXT_NODE;\n}\n\n/**\n * Check if en element node can be inserted before `child`, or at the end if child is falsy,\n * according to the presence and position of a doctype node on the same level.\n *\n * @param {Document} doc The document node\n * @param {Node} child the node that would become the nextSibling if the element would be inserted\n * @returns {boolean} `true` if an element can be inserted before child\n * @private\n * https://dom.spec.whatwg.org/#concept-node-ensure-pre-insertion-validity\n */\nfunction isElementInsertionPossible(doc, child) {\n\tvar parentChildNodes = doc.childNodes || [];\n\tif (find(parentChildNodes, isElementNode) || isDocTypeNode(child)) {\n\t\treturn false;\n\t}\n\tvar docTypeNode = find(parentChildNodes, isDocTypeNode);\n\treturn !(child && docTypeNode && parentChildNodes.indexOf(docTypeNode) > parentChildNodes.indexOf(child));\n}\n\n/**\n * Check if en element node can be inserted before `child`, or at the end if child is falsy,\n * according to the presence and position of a doctype node on the same level.\n *\n * @param {Node} doc The document node\n * @param {Node} child the node that would become the nextSibling if the element would be inserted\n * @returns {boolean} `true` if an element can be inserted before child\n * @private\n * https://dom.spec.whatwg.org/#concept-node-ensure-pre-insertion-validity\n */\nfunction isElementReplacementPossible(doc, child) {\n\tvar parentChildNodes = doc.childNodes || [];\n\n\tfunction hasElementChildThatIsNotChild(node) {\n\t\treturn isElementNode(node) && node !== child;\n\t}\n\n\tif (find(parentChildNodes, hasElementChildThatIsNotChild)) {\n\t\treturn false;\n\t}\n\tvar docTypeNode = find(parentChildNodes, isDocTypeNode);\n\treturn !(child && docTypeNode && parentChildNodes.indexOf(docTypeNode) > parentChildNodes.indexOf(child));\n}\n\n/**\n * @private\n * Steps 1-5 of the checks before inserting and before replacing a child are the same.\n *\n * @param {Node} parent the parent node to insert `node` into\n * @param {Node} node the node to insert\n * @param {Node=} child the node that should become the `nextSibling` of `node`\n * @returns {Node}\n * @throws DOMException for several node combinations that would create a DOM that is not well-formed.\n * @throws DOMException if `child` is provided but is not a child of `parent`.\n * @see https://dom.spec.whatwg.org/#concept-node-ensure-pre-insertion-validity\n * @see https://dom.spec.whatwg.org/#concept-node-replace\n */\nfunction assertPreInsertionValidity1to5(parent, node, child) {\n\t// 1. If `parent` is not a Document, DocumentFragment, or Element node, then throw a \"HierarchyRequestError\" DOMException.\n\tif (!hasValidParentNodeType(parent)) {\n\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Unexpected parent node type ' + parent.nodeType);\n\t}\n\t// 2. If `node` is a host-including inclusive ancestor of `parent`, then throw a \"HierarchyRequestError\" DOMException.\n\t// not implemented!\n\t// 3. If `child` is non-null and its parent is not `parent`, then throw a \"NotFoundError\" DOMException.\n\tif (child && child.parentNode !== parent) {\n\t\tthrow new DOMException(NOT_FOUND_ERR, 'child not in parent');\n\t}\n\tif (\n\t\t// 4. If `node` is not a DocumentFragment, DocumentType, Element, or CharacterData node, then throw a \"HierarchyRequestError\" DOMException.\n\t\t!hasInsertableNodeType(node) ||\n\t\t// 5. If either `node` is a Text node and `parent` is a document,\n\t\t// the sax parser currently adds top level text nodes, this will be fixed in 0.9.0\n\t\t// || (node.nodeType === Node.TEXT_NODE && parent.nodeType === Node.DOCUMENT_NODE)\n\t\t// or `node` is a doctype and `parent` is not a document, then throw a \"HierarchyRequestError\" DOMException.\n\t\t(isDocTypeNode(node) && parent.nodeType !== Node.DOCUMENT_NODE)\n\t) {\n\t\tthrow new DOMException(\n\t\t\tHIERARCHY_REQUEST_ERR,\n\t\t\t'Unexpected node type ' + node.nodeType + ' for parent node type ' + parent.nodeType\n\t\t);\n\t}\n}\n\n/**\n * @private\n * Step 6 of the checks before inserting and before replacing a child are different.\n *\n * @param {Document} parent the parent node to insert `node` into\n * @param {Node} node the node to insert\n * @param {Node | undefined} child the node that should become the `nextSibling` of `node`\n * @returns {Node}\n * @throws DOMException for several node combinations that would create a DOM that is not well-formed.\n * @throws DOMException if `child` is provided but is not a child of `parent`.\n * @see https://dom.spec.whatwg.org/#concept-node-ensure-pre-insertion-validity\n * @see https://dom.spec.whatwg.org/#concept-node-replace\n */\nfunction assertPreInsertionValidityInDocument(parent, node, child) {\n\tvar parentChildNodes = parent.childNodes || [];\n\tvar nodeChildNodes = node.childNodes || [];\n\n\t// DocumentFragment\n\tif (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n\t\tvar nodeChildElements = nodeChildNodes.filter(isElementNode);\n\t\t// If node has more than one element child or has a Text node child.\n\t\tif (nodeChildElements.length > 1 || find(nodeChildNodes, isTextNode)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'More than one element or text in fragment');\n\t\t}\n\t\t// Otherwise, if `node` has one element child and either `parent` has an element child,\n\t\t// `child` is a doctype, or `child` is non-null and a doctype is following `child`.\n\t\tif (nodeChildElements.length === 1 && !isElementInsertionPossible(parent, child)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Element in fragment can not be inserted before doctype');\n\t\t}\n\t}\n\t// Element\n\tif (isElementNode(node)) {\n\t\t// `parent` has an element child, `child` is a doctype,\n\t\t// or `child` is non-null and a doctype is following `child`.\n\t\tif (!isElementInsertionPossible(parent, child)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Only one element can be added and only after doctype');\n\t\t}\n\t}\n\t// DocumentType\n\tif (isDocTypeNode(node)) {\n\t\t// `parent` has a doctype child,\n\t\tif (find(parentChildNodes, isDocTypeNode)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Only one doctype is allowed');\n\t\t}\n\t\tvar parentElementChild = find(parentChildNodes, isElementNode);\n\t\t// `child` is non-null and an element is preceding `child`,\n\t\tif (child && parentChildNodes.indexOf(parentElementChild) < parentChildNodes.indexOf(child)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Doctype can only be inserted before an element');\n\t\t}\n\t\t// or `child` is null and `parent` has an element child.\n\t\tif (!child && parentElementChild) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Doctype can not be appended since element is present');\n\t\t}\n\t}\n}\n\n/**\n * @private\n * Step 6 of the checks before inserting and before replacing a child are different.\n *\n * @param {Document} parent the parent node to insert `node` into\n * @param {Node} node the node to insert\n * @param {Node | undefined} child the node that should become the `nextSibling` of `node`\n * @returns {Node}\n * @throws DOMException for several node combinations that would create a DOM that is not well-formed.\n * @throws DOMException if `child` is provided but is not a child of `parent`.\n * @see https://dom.spec.whatwg.org/#concept-node-ensure-pre-insertion-validity\n * @see https://dom.spec.whatwg.org/#concept-node-replace\n */\nfunction assertPreReplacementValidityInDocument(parent, node, child) {\n\tvar parentChildNodes = parent.childNodes || [];\n\tvar nodeChildNodes = node.childNodes || [];\n\n\t// DocumentFragment\n\tif (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n\t\tvar nodeChildElements = nodeChildNodes.filter(isElementNode);\n\t\t// If `node` has more than one element child or has a Text node child.\n\t\tif (nodeChildElements.length > 1 || find(nodeChildNodes, isTextNode)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'More than one element or text in fragment');\n\t\t}\n\t\t// Otherwise, if `node` has one element child and either `parent` has an element child that is not `child` or a doctype is following `child`.\n\t\tif (nodeChildElements.length === 1 && !isElementReplacementPossible(parent, child)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Element in fragment can not be inserted before doctype');\n\t\t}\n\t}\n\t// Element\n\tif (isElementNode(node)) {\n\t\t// `parent` has an element child that is not `child` or a doctype is following `child`.\n\t\tif (!isElementReplacementPossible(parent, child)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Only one element can be added and only after doctype');\n\t\t}\n\t}\n\t// DocumentType\n\tif (isDocTypeNode(node)) {\n\t\tfunction hasDoctypeChildThatIsNotChild(node) {\n\t\t\treturn isDocTypeNode(node) && node !== child;\n\t\t}\n\n\t\t// `parent` has a doctype child that is not `child`,\n\t\tif (find(parentChildNodes, hasDoctypeChildThatIsNotChild)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Only one doctype is allowed');\n\t\t}\n\t\tvar parentElementChild = find(parentChildNodes, isElementNode);\n\t\t// or an element is preceding `child`.\n\t\tif (child && parentChildNodes.indexOf(parentElementChild) < parentChildNodes.indexOf(child)) {\n\t\t\tthrow new DOMException(HIERARCHY_REQUEST_ERR, 'Doctype can only be inserted before an element');\n\t\t}\n\t}\n}\n\n/**\n * @private\n * @param {Node} parent the parent node to insert `node` into\n * @param {Node} node the node to insert\n * @param {Node=} child the node that should become the `nextSibling` of `node`\n * @returns {Node}\n * @throws DOMException for several node combinations that would create a DOM that is not well-formed.\n * @throws DOMException if `child` is provided but is not a child of `parent`.\n * @see https://dom.spec.whatwg.org/#concept-node-ensure-pre-insertion-validity\n */\nfunction _insertBefore(parent, node, child, _inDocumentAssertion) {\n\t// To ensure pre-insertion validity of a node into a parent before a child, run these steps:\n\tassertPreInsertionValidity1to5(parent, node, child);\n\n\t// If parent is a document, and any of the statements below, switched on the interface node implements,\n\t// are true, then throw a \"HierarchyRequestError\" DOMException.\n\tif (parent.nodeType === Node.DOCUMENT_NODE) {\n\t\t(_inDocumentAssertion || assertPreInsertionValidityInDocument)(parent, node, child);\n\t}\n\n\tvar cp = node.parentNode;\n\tif(cp){\n\t\tcp.removeChild(node);//remove and update\n\t}\n\tif(node.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\tvar newFirst = node.firstChild;\n\t\tif (newFirst == null) {\n\t\t\treturn node;\n\t\t}\n\t\tvar newLast = node.lastChild;\n\t}else{\n\t\tnewFirst = newLast = node;\n\t}\n\tvar pre = child ? child.previousSibling : parent.lastChild;\n\n\tnewFirst.previousSibling = pre;\n\tnewLast.nextSibling = child;\n\n\n\tif(pre){\n\t\tpre.nextSibling = newFirst;\n\t}else{\n\t\tparent.firstChild = newFirst;\n\t}\n\tif(child == null){\n\t\tparent.lastChild = newLast;\n\t}else{\n\t\tchild.previousSibling = newLast;\n\t}\n\tdo{\n\t\tnewFirst.parentNode = parent;\n\t}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))\n\t_onUpdateChild(parent.ownerDocument||parent, parent);\n\t//console.log(parent.lastChild.nextSibling == null)\n\tif (node.nodeType == DOCUMENT_FRAGMENT_NODE) {\n\t\tnode.firstChild = node.lastChild = null;\n\t}\n\treturn node;\n}\nfunction _appendSingleChild(parentNode,newChild){\n\tif (newChild.parentNode) {\n\t\tnewChild.parentNode.removeChild(newChild);\n\t}\n\tnewChild.parentNode = parentNode;\n\tnewChild.previousSibling = parentNode.lastChild;\n\tnewChild.nextSibling = null;\n\tif (newChild.previousSibling) {\n\t\tnewChild.previousSibling.nextSibling = newChild;\n\t}else{\n\t\tparentNode.firstChild = newChild;\n\t}\n\tparentNode.lastChild = newChild;\n\t_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);\n\treturn newChild;\n}\n\nDocument.prototype = {\n\t//implementation : null,\n\tnodeName :  '#document',\n\tnodeType :  DOCUMENT_NODE,\n\t/**\n\t * The DocumentType node of the document.\n\t *\n\t * @readonly\n\t * @type DocumentType\n\t */\n\tdoctype :  null,\n\tdocumentElement :  null,\n\t_inc : 1,\n\n\tinsertBefore :  function(newChild, refChild){//raises\n\t\tif(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){\n\t\t\tvar child = newChild.firstChild;\n\t\t\twhile(child){\n\t\t\t\tvar next = child.nextSibling;\n\t\t\t\tthis.insertBefore(child,refChild);\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t\treturn newChild;\n\t\t}\n\t\t_insertBefore(this, newChild, refChild);\n\t\tnewChild.ownerDocument = this;\n\t\tif (this.documentElement === null && newChild.nodeType === ELEMENT_NODE) {\n\t\t\tthis.documentElement = newChild;\n\t\t}\n\n\t\treturn newChild;\n\t},\n\tremoveChild :  function(oldChild){\n\t\tif(this.documentElement == oldChild){\n\t\t\tthis.documentElement = null;\n\t\t}\n\t\treturn _removeChild(this,oldChild);\n\t},\n\treplaceChild: function (newChild, oldChild) {\n\t\t//raises\n\t\t_insertBefore(this, newChild, oldChild, assertPreReplacementValidityInDocument);\n\t\tnewChild.ownerDocument = this;\n\t\tif (oldChild) {\n\t\t\tthis.removeChild(oldChild);\n\t\t}\n\t\tif (isElementNode(newChild)) {\n\t\t\tthis.documentElement = newChild;\n\t\t}\n\t},\n\t// Introduced in DOM Level 2:\n\timportNode : function(importedNode,deep){\n\t\treturn importNode(this,importedNode,deep);\n\t},\n\t// Introduced in DOM Level 2:\n\tgetElementById :\tfunction(id){\n\t\tvar rtv = null;\n\t\t_visitNode(this.documentElement,function(node){\n\t\t\tif(node.nodeType == ELEMENT_NODE){\n\t\t\t\tif(node.getAttribute('id') == id){\n\t\t\t\t\trtv = node;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn rtv;\n\t},\n\n\t/**\n\t * The `getElementsByClassName` method of `Document` interface returns an array-like object\n\t * of all child elements which have **all** of the given class name(s).\n\t *\n\t * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.\n\t *\n\t *\n\t * Warning: This is a live LiveNodeList.\n\t * Changes in the DOM will reflect in the array as the changes occur.\n\t * If an element selected by this array no longer qualifies for the selector,\n\t * it will automatically be removed. Be aware of this for iteration purposes.\n\t *\n\t * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace\n\t *\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\n\t * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname\n\t */\n\tgetElementsByClassName: function(classNames) {\n\t\tvar classNamesSet = toOrderedSet(classNames)\n\t\treturn new LiveNodeList(this, function(base) {\n\t\t\tvar ls = [];\n\t\t\tif (classNamesSet.length > 0) {\n\t\t\t\t_visitNode(base.documentElement, function(node) {\n\t\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tvar nodeClassNames = node.getAttribute('class')\n\t\t\t\t\t\t// can be null if the attribute does not exist\n\t\t\t\t\t\tif (nodeClassNames) {\n\t\t\t\t\t\t\t// before splitting and iterating just compare them for the most common case\n\t\t\t\t\t\t\tvar matches = classNames === nodeClassNames;\n\t\t\t\t\t\t\tif (!matches) {\n\t\t\t\t\t\t\t\tvar nodeClassNamesSet = toOrderedSet(nodeClassNames)\n\t\t\t\t\t\t\t\tmatches = classNamesSet.every(arrayIncludes(nodeClassNamesSet))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(matches) {\n\t\t\t\t\t\t\t\tls.push(node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ls;\n\t\t});\n\t},\n\n\t//document factory method:\n\tcreateElement :\tfunction(tagName){\n\t\tvar node = new Element();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = tagName;\n\t\tnode.tagName = tagName;\n\t\tnode.localName = tagName;\n\t\tnode.childNodes = new NodeList();\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\tcreateDocumentFragment :\tfunction(){\n\t\tvar node = new DocumentFragment();\n\t\tnode.ownerDocument = this;\n\t\tnode.childNodes = new NodeList();\n\t\treturn node;\n\t},\n\tcreateTextNode :\tfunction(data){\n\t\tvar node = new Text();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateComment :\tfunction(data){\n\t\tvar node = new Comment();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateCDATASection :\tfunction(data){\n\t\tvar node = new CDATASection();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateProcessingInstruction :\tfunction(target,data){\n\t\tvar node = new ProcessingInstruction();\n\t\tnode.ownerDocument = this;\n\t\tnode.tagName = node.nodeName = node.target = target;\n\t\tnode.nodeValue = node.data = data;\n\t\treturn node;\n\t},\n\tcreateAttribute :\tfunction(name){\n\t\tvar node = new Attr();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.name = name;\n\t\tnode.nodeName\t= name;\n\t\tnode.localName = name;\n\t\tnode.specified = true;\n\t\treturn node;\n\t},\n\tcreateEntityReference :\tfunction(name){\n\t\tvar node = new EntityReference();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.nodeName\t= name;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateElementNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Element();\n\t\tvar pl = qualifiedName.split(':');\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tnode.childNodes = new NodeList();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.tagName = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateAttributeNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Attr();\n\t\tvar pl = qualifiedName.split(':');\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.name = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tnode.specified = true;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\treturn node;\n\t}\n};\n_extends(Document,Node);\n\n\nfunction Element() {\n\tthis._nsMap = {};\n};\nElement.prototype = {\n\tnodeType : ELEMENT_NODE,\n\thasAttribute : function(name){\n\t\treturn this.getAttributeNode(name)!=null;\n\t},\n\tgetAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name);\n\t\treturn attr && attr.value || '';\n\t},\n\tgetAttributeNode : function(name){\n\t\treturn this.attributes.getNamedItem(name);\n\t},\n\tsetAttribute : function(name, value){\n\t\tvar attr = this.ownerDocument.createAttribute(name);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tremoveAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name)\n\t\tattr && this.removeAttributeNode(attr);\n\t},\n\n\t//four real opeartion method\n\tappendChild:function(newChild){\n\t\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\t\treturn this.insertBefore(newChild,null);\n\t\t}else{\n\t\t\treturn _appendSingleChild(this,newChild);\n\t\t}\n\t},\n\tsetAttributeNode : function(newAttr){\n\t\treturn this.attributes.setNamedItem(newAttr);\n\t},\n\tsetAttributeNodeNS : function(newAttr){\n\t\treturn this.attributes.setNamedItemNS(newAttr);\n\t},\n\tremoveAttributeNode : function(oldAttr){\n\t\t//console.log(this == oldAttr.ownerElement)\n\t\treturn this.attributes.removeNamedItem(oldAttr.nodeName);\n\t},\n\t//get real attribute name,and remove it by removeAttributeNode\n\tremoveAttributeNS : function(namespaceURI, localName){\n\t\tvar old = this.getAttributeNodeNS(namespaceURI, localName);\n\t\told && this.removeAttributeNode(old);\n\t},\n\n\thasAttributeNS : function(namespaceURI, localName){\n\t\treturn this.getAttributeNodeNS(namespaceURI, localName)!=null;\n\t},\n\tgetAttributeNS : function(namespaceURI, localName){\n\t\tvar attr = this.getAttributeNodeNS(namespaceURI, localName);\n\t\treturn attr && attr.value || '';\n\t},\n\tsetAttributeNS : function(namespaceURI, qualifiedName, value){\n\t\tvar attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tgetAttributeNodeNS : function(namespaceURI, localName){\n\t\treturn this.attributes.getNamedItemNS(namespaceURI, localName);\n\t},\n\n\tgetElementsByTagName : function(tagName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t});\n\t},\n\tgetElementsByTagNameNS : function(namespaceURI, localName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\n\t\t});\n\t}\n};\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\n\n\n_extends(Element,Node);\nfunction Attr() {\n};\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\n_extends(Attr,Node);\n\n\nfunction CharacterData() {\n};\nCharacterData.prototype = {\n\tdata : '',\n\tsubstringData : function(offset, count) {\n\t\treturn this.data.substring(offset, offset+count);\n\t},\n\tappendData: function(text) {\n\t\ttext = this.data+text;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t},\n\tinsertData: function(offset,text) {\n\t\tthis.replaceData(offset,0,text);\n\n\t},\n\tappendChild:function(newChild){\n\t\tthrow new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])\n\t},\n\tdeleteData: function(offset, count) {\n\t\tthis.replaceData(offset,count,\"\");\n\t},\n\treplaceData: function(offset, count, text) {\n\t\tvar start = this.data.substring(0,offset);\n\t\tvar end = this.data.substring(offset+count);\n\t\ttext = start + text + end;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t}\n}\n_extends(CharacterData,Node);\nfunction Text() {\n};\nText.prototype = {\n\tnodeName : \"#text\",\n\tnodeType : TEXT_NODE,\n\tsplitText : function(offset) {\n\t\tvar text = this.data;\n\t\tvar newText = text.substring(offset);\n\t\ttext = text.substring(0, offset);\n\t\tthis.data = this.nodeValue = text;\n\t\tthis.length = text.length;\n\t\tvar newNode = this.ownerDocument.createTextNode(newText);\n\t\tif(this.parentNode){\n\t\t\tthis.parentNode.insertBefore(newNode, this.nextSibling);\n\t\t}\n\t\treturn newNode;\n\t}\n}\n_extends(Text,CharacterData);\nfunction Comment() {\n};\nComment.prototype = {\n\tnodeName : \"#comment\",\n\tnodeType : COMMENT_NODE\n}\n_extends(Comment,CharacterData);\n\nfunction CDATASection() {\n};\nCDATASection.prototype = {\n\tnodeName : \"#cdata-section\",\n\tnodeType : CDATA_SECTION_NODE\n}\n_extends(CDATASection,CharacterData);\n\n\nfunction DocumentType() {\n};\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\n_extends(DocumentType,Node);\n\nfunction Notation() {\n};\nNotation.prototype.nodeType = NOTATION_NODE;\n_extends(Notation,Node);\n\nfunction Entity() {\n};\nEntity.prototype.nodeType = ENTITY_NODE;\n_extends(Entity,Node);\n\nfunction EntityReference() {\n};\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\n_extends(EntityReference,Node);\n\nfunction DocumentFragment() {\n};\nDocumentFragment.prototype.nodeName =\t\"#document-fragment\";\nDocumentFragment.prototype.nodeType =\tDOCUMENT_FRAGMENT_NODE;\n_extends(DocumentFragment,Node);\n\n\nfunction ProcessingInstruction() {\n}\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\n_extends(ProcessingInstruction,Node);\nfunction XMLSerializer(){}\nXMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){\n\treturn nodeSerializeToString.call(node,isHtml,nodeFilter);\n}\nNode.prototype.toString = nodeSerializeToString;\nfunction nodeSerializeToString(isHtml,nodeFilter){\n\tvar buf = [];\n\tvar refNode = this.nodeType == 9 && this.documentElement || this;\n\tvar prefix = refNode.prefix;\n\tvar uri = refNode.namespaceURI;\n\n\tif(uri && prefix == null){\n\t\t//console.log(prefix)\n\t\tvar prefix = refNode.lookupPrefix(uri);\n\t\tif(prefix == null){\n\t\t\t//isHTML = true;\n\t\t\tvar visibleNamespaces=[\n\t\t\t{namespace:uri,prefix:null}\n\t\t\t//{namespace:uri,prefix:''}\n\t\t\t]\n\t\t}\n\t}\n\tserializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);\n\t//console.log('###',this.nodeType,uri,prefix,buf.join(''))\n\treturn buf.join('');\n}\n\nfunction needNamespaceDefine(node, isHTML, visibleNamespaces) {\n\tvar prefix = node.prefix || '';\n\tvar uri = node.namespaceURI;\n\t// According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,\n\t// and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :\n\t// > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.\n\t// in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)\n\t// and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :\n\t// > [...] Furthermore, the attribute value [...] must not be an empty string.\n\t// so serializing empty namespace value like xmlns:ds=\"\" would produce an invalid XML document.\n\tif (!uri) {\n\t\treturn false;\n\t}\n\tif (prefix === \"xml\" && uri === NAMESPACE.XML || uri === NAMESPACE.XMLNS) {\n\t\treturn false;\n\t}\n\n\tvar i = visibleNamespaces.length\n\twhile (i--) {\n\t\tvar ns = visibleNamespaces[i];\n\t\t// get namespace prefix\n\t\tif (ns.prefix === prefix) {\n\t\t\treturn ns.namespace !== uri;\n\t\t}\n\t}\n\treturn true;\n}\n/**\n * Well-formed constraint: No < in Attribute Values\n * The replacement text of any entity referred to directly or indirectly in an attribute value must not contain a <.\n * @see https://www.w3.org/TR/xml/#CleanAttrVals\n * @see https://www.w3.org/TR/xml/#NT-AttValue\n */\nfunction addSerializedAttribute(buf, qualifiedName, value) {\n\tbuf.push(' ', qualifiedName, '=\"', value.replace(/[<&\"]/g,_xmlEncoder), '\"')\n}\n\nfunction serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){\n\tif (!visibleNamespaces) {\n\t\tvisibleNamespaces = [];\n\t}\n\n\tif(nodeFilter){\n\t\tnode = nodeFilter(node);\n\t\tif(node){\n\t\t\tif(typeof node == 'string'){\n\t\t\t\tbuf.push(node);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}else{\n\t\t\treturn;\n\t\t}\n\t\t//buf.sort.apply(attrs, attributeSorter);\n\t}\n\n\tswitch(node.nodeType){\n\tcase ELEMENT_NODE:\n\t\tvar attrs = node.attributes;\n\t\tvar len = attrs.length;\n\t\tvar child = node.firstChild;\n\t\tvar nodeName = node.tagName;\n\n\t\tisHTML = NAMESPACE.isHTML(node.namespaceURI) || isHTML\n\n\t\tvar prefixedNodeName = nodeName\n\t\tif (!isHTML && !node.prefix && node.namespaceURI) {\n\t\t\tvar defaultNS\n\t\t\t// lookup current default ns from `xmlns` attribute\n\t\t\tfor (var ai = 0; ai < attrs.length; ai++) {\n\t\t\t\tif (attrs.item(ai).name === 'xmlns') {\n\t\t\t\t\tdefaultNS = attrs.item(ai).value\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!defaultNS) {\n\t\t\t\t// lookup current default ns in visibleNamespaces\n\t\t\t\tfor (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\n\t\t\t\t\tvar namespace = visibleNamespaces[nsi]\n\t\t\t\t\tif (namespace.prefix === '' && namespace.namespace === node.namespaceURI) {\n\t\t\t\t\t\tdefaultNS = namespace.namespace\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (defaultNS !== node.namespaceURI) {\n\t\t\t\tfor (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {\n\t\t\t\t\tvar namespace = visibleNamespaces[nsi]\n\t\t\t\t\tif (namespace.namespace === node.namespaceURI) {\n\t\t\t\t\t\tif (namespace.prefix) {\n\t\t\t\t\t\t\tprefixedNodeName = namespace.prefix + ':' + nodeName\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tbuf.push('<', prefixedNodeName);\n\n\t\tfor(var i=0;i<len;i++){\n\t\t\t// add namespaces for attributes\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (attr.prefix == 'xmlns') {\n\t\t\t\tvisibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });\n\t\t\t}else if(attr.nodeName == 'xmlns'){\n\t\t\t\tvisibleNamespaces.push({ prefix: '', namespace: attr.value });\n\t\t\t}\n\t\t}\n\n\t\tfor(var i=0;i<len;i++){\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {\n\t\t\t\tvar prefix = attr.prefix||'';\n\t\t\t\tvar uri = attr.namespaceURI;\n\t\t\t\taddSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\n\t\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t\t}\n\t\t\tserializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t}\n\n\t\t// add namespace for current node\n\t\tif (nodeName === prefixedNodeName && needNamespaceDefine(node, isHTML, visibleNamespaces)) {\n\t\t\tvar prefix = node.prefix||'';\n\t\t\tvar uri = node.namespaceURI;\n\t\t\taddSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : \"xmlns\", uri);\n\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t}\n\n\t\tif(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){\n\t\t\tbuf.push('>');\n\t\t\t//if is cdata child node\n\t\t\tif(isHTML && /^script$/i.test(nodeName)){\n\t\t\t\twhile(child){\n\t\t\t\t\tif(child.data){\n\t\t\t\t\t\tbuf.push(child.data);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n\t\t\t\t\t}\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}else\n\t\t\t{\n\t\t\t\twhile(child){\n\t\t\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf.push('</',prefixedNodeName,'>');\n\t\t}else{\n\t\t\tbuf.push('/>');\n\t\t}\n\t\t// remove added visible namespaces\n\t\t//visibleNamespaces.length = startVisibleNamespaces;\n\t\treturn;\n\tcase DOCUMENT_NODE:\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tserializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t\treturn;\n\tcase ATTRIBUTE_NODE:\n\t\treturn addSerializedAttribute(buf, node.name, node.value);\n\tcase TEXT_NODE:\n\t\t/**\n\t\t * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,\n\t\t * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.\n\t\t * If they are needed elsewhere, they must be escaped using either numeric character references or the strings\n\t\t * `&amp;` and `&lt;` respectively.\n\t\t * The right angle bracket (>) may be represented using the string \" &gt; \", and must, for compatibility,\n\t\t * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,\n\t\t * when that string is not marking the end of a CDATA section.\n\t\t *\n\t\t * In the content of elements, character data is any string of characters\n\t\t * which does not contain the start-delimiter of any markup\n\t\t * and does not include the CDATA-section-close delimiter, `]]>`.\n\t\t *\n\t\t * @see https://www.w3.org/TR/xml/#NT-CharData\n\t\t */\n\t\treturn buf.push(node.data\n\t\t\t.replace(/[<&]/g,_xmlEncoder)\n\t\t\t.replace(/]]>/g, ']]&gt;')\n\t\t);\n\tcase CDATA_SECTION_NODE:\n\t\treturn buf.push( '<![CDATA[',node.data,']]>');\n\tcase COMMENT_NODE:\n\t\treturn buf.push( \"<!--\",node.data,\"-->\");\n\tcase DOCUMENT_TYPE_NODE:\n\t\tvar pubid = node.publicId;\n\t\tvar sysid = node.systemId;\n\t\tbuf.push('<!DOCTYPE ',node.name);\n\t\tif(pubid){\n\t\t\tbuf.push(' PUBLIC ', pubid);\n\t\t\tif (sysid && sysid!='.') {\n\t\t\t\tbuf.push(' ', sysid);\n\t\t\t}\n\t\t\tbuf.push('>');\n\t\t}else if(sysid && sysid!='.'){\n\t\t\tbuf.push(' SYSTEM ', sysid, '>');\n\t\t}else{\n\t\t\tvar sub = node.internalSubset;\n\t\t\tif(sub){\n\t\t\t\tbuf.push(\" [\",sub,\"]\");\n\t\t\t}\n\t\t\tbuf.push(\">\");\n\t\t}\n\t\treturn;\n\tcase PROCESSING_INSTRUCTION_NODE:\n\t\treturn buf.push( \"<?\",node.target,\" \",node.data,\"?>\");\n\tcase ENTITY_REFERENCE_NODE:\n\t\treturn buf.push( '&',node.nodeName,';');\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE:\n\tdefault:\n\t\tbuf.push('??',node.nodeName);\n\t}\n}\nfunction importNode(doc,node,deep){\n\tvar node2;\n\tswitch (node.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tnode2 = node.cloneNode(false);\n\t\tnode2.ownerDocument = doc;\n\t\t//var attrs = node2.attributes;\n\t\t//var len = attrs.length;\n\t\t//for(var i=0;i<len;i++){\n\t\t\t//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\n\t\t//}\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tbreak;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t\tbreak;\n\t//case ENTITY_REFERENCE_NODE:\n\t//case PROCESSING_INSTRUCTION_NODE:\n\t////case TEXT_NODE:\n\t//case CDATA_SECTION_NODE:\n\t//case COMMENT_NODE:\n\t//\tdeep = false;\n\t//\tbreak;\n\t//case DOCUMENT_NODE:\n\t//case DOCUMENT_TYPE_NODE:\n\t//cannot be imported.\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE\n\t//can not hit in level3\n\t//default:throw e;\n\t}\n\tif(!node2){\n\t\tnode2 = node.cloneNode(false);//false\n\t}\n\tnode2.ownerDocument = doc;\n\tnode2.parentNode = null;\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(importNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n//\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\nfunction cloneNode(doc,node,deep){\n\tvar node2 = new node.constructor();\n\tfor (var n in node) {\n\t\tif (Object.prototype.hasOwnProperty.call(node, n)) {\n\t\t\tvar v = node[n];\n\t\t\tif (typeof v != \"object\") {\n\t\t\t\tif (v != node2[n]) {\n\t\t\t\t\tnode2[n] = v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif(node.childNodes){\n\t\tnode2.childNodes = new NodeList();\n\t}\n\tnode2.ownerDocument = doc;\n\tswitch (node2.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tvar attrs\t= node.attributes;\n\t\tvar attrs2\t= node2.attributes = new NamedNodeMap();\n\t\tvar len = attrs.length\n\t\tattrs2._ownerElement = node2;\n\t\tfor(var i=0;i<len;i++){\n\t\t\tnode2.setAttributeNode(cloneNode(doc,attrs.item(i),true));\n\t\t}\n\t\tbreak;;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t}\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(cloneNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n\nfunction __set__(object,key,value){\n\tobject[key] = value\n}\n//do dynamic\ntry{\n\tif(Object.defineProperty){\n\t\tObject.defineProperty(LiveNodeList.prototype,'length',{\n\t\t\tget:function(){\n\t\t\t\t_updateLiveList(this);\n\t\t\t\treturn this.$$length;\n\t\t\t}\n\t\t});\n\n\t\tObject.defineProperty(Node.prototype,'textContent',{\n\t\t\tget:function(){\n\t\t\t\treturn getTextContent(this);\n\t\t\t},\n\n\t\t\tset:function(data){\n\t\t\t\tswitch(this.nodeType){\n\t\t\t\tcase ELEMENT_NODE:\n\t\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\t\twhile(this.firstChild){\n\t\t\t\t\t\tthis.removeChild(this.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tif(data || String(data)){\n\t\t\t\t\t\tthis.appendChild(this.ownerDocument.createTextNode(data));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthis.data = data;\n\t\t\t\t\tthis.value = data;\n\t\t\t\t\tthis.nodeValue = data;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tfunction getTextContent(node){\n\t\t\tswitch(node.nodeType){\n\t\t\tcase ELEMENT_NODE:\n\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\tvar buf = [];\n\t\t\t\tnode = node.firstChild;\n\t\t\t\twhile(node){\n\t\t\t\t\tif(node.nodeType!==7 && node.nodeType !==8){\n\t\t\t\t\t\tbuf.push(getTextContent(node));\n\t\t\t\t\t}\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t\treturn buf.join('');\n\t\t\tdefault:\n\t\t\t\treturn node.nodeValue;\n\t\t\t}\n\t\t}\n\n\t\t__set__ = function(object,key,value){\n\t\t\t//console.log(value)\n\t\t\tobject['$$'+key] = value\n\t\t}\n\t}\n}catch(e){//ie8\n}\n\n//if(typeof require == 'function'){\n\texports.DocumentType = DocumentType;\n\texports.DOMException = DOMException;\n\texports.DOMImplementation = DOMImplementation;\n\texports.Element = Element;\n\texports.Node = Node;\n\texports.NodeList = NodeList;\n\texports.XMLSerializer = XMLSerializer;\n//}\n"],"names":["conventions","require$$0","find","NAMESPACE","notEmptyString","input","splitOnASCIIWhitespace","orderedSetReducer","current","element","toOrderedSet","list","arrayIncludes","copy","src","dest","p","_extends","Class","Super","pt","t","NodeType","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","ExceptionCode","ExceptionMessage","HIERARCHY_REQUEST_ERR","NOT_FOUND_ERR","INUSE_ATTRIBUTE_ERR","DOMException","code","message","error","NodeList","index","isHTML","nodeFilter","buf","i","serializeToString","predicate","item","LiveNodeList","node","refresh","_updateLiveList","inc","ls","__set__","NamedNodeMap","_findNodeIndex","_addNamedNode","el","newAttr","oldAttr","doc","_onRemoveAttribute","_onAddAttribute","_removeNamedNode","attr","lastIndex","key","namespaceURI","localName","DOMImplementation","feature","version","qualifiedName","doctype","Document","root","publicId","systemId","DocumentType","Node","newChild","refChild","_insertBefore","oldChild","assertPreReplacementValidityInDocument","_removeChild","deep","cloneNode","child","next","map","n","prefix","_xmlEncoder","c","_visitNode","callback","ns","remove","_onUpdateChild","cs","parentNode","previous","hasValidParentNodeType","hasInsertableNodeType","isElementNode","isTextNode","isDocTypeNode","isElementInsertionPossible","parentChildNodes","docTypeNode","isElementReplacementPossible","hasElementChildThatIsNotChild","assertPreInsertionValidity1to5","parent","assertPreInsertionValidityInDocument","nodeChildNodes","nodeChildElements","parentElementChild","_inDocumentAssertion","cp","newFirst","newLast","pre","_appendSingleChild","importedNode","importNode","id","rtv","classNames","classNamesSet","base","nodeClassNames","matches","nodeClassNamesSet","tagName","Element","attrs","DocumentFragment","data","Text","Comment","CDATASection","target","ProcessingInstruction","name","Attr","EntityReference","pl","value","old","CharacterData","offset","count","text","start","end","newText","newNode","Notation","Entity","XMLSerializer","isHtml","nodeSerializeToString","refNode","uri","visibleNamespaces","needNamespaceDefine","addSerializedAttribute","len","nodeName","prefixedNodeName","defaultNS","ai","nsi","namespace","pubid","sysid","sub","node2","v","attrs2","object","getTextContent","dom"],"mappings":"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","x_google_ignoreList":[0]}